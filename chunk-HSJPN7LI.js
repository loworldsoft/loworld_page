import{a as he}from"./chunk-4OVRC2T3.js";import{c as ue,d as Ce}from"./chunk-CUH633CQ.js";import{b as de}from"./chunk-7WHTN2YU.js";import{a as ge,b as pe}from"./chunk-MQEEND4T.js";import{a as me,b as le}from"./chunk-UFNXZ2RB.js";import{k as re,m as ae,p as se,q as B,r as ce}from"./chunk-VMMX27LC.js";import{fa as oe,ia as ie}from"./chunk-32NNWNAI.js";import{$ as R,A as K,E as U,F as Z,G as J,H as X,I as ee,W as te,X as ne,Z as T,ba as P,d as S,e as E,m as G}from"./chunk-4DTSJNKC.js";import{$b as $,Jb as m,Kb as i,Lb as r,Mb as b,Qb as M,S as v,Ta as q,Ub as _,Vb as g,Za as s,Zb as L,_ as w,_b as j,cb as f,f as y,fc as H,ha as u,ia as C,ic as a,jb as I,jc as x,kb as k,kc as O,oc as Q,pb as d,pc as W,qc as Y}from"./chunk-F2JKNDFL.js";import{a as F,b as V,e as h}from"./chunk-JKOY2XUY.js";var be=["chatMessages"];function Oe(n,e){if(n&1){let t=M();i(0,"div",17)(1,"mat-icon",18),a(2,"error_outline"),r(),i(3,"h3"),a(4,"\uC5F0\uACB0 \uC2E4\uD328"),r(),i(5,"p"),a(6),r(),i(7,"button",19),_("click",function(){u(t);let c=g();return C(c.initNewChat())}),i(8,"mat-icon"),a(9,"refresh"),r(),a(10," \uB2E4\uC2DC \uC2DC\uB3C4 "),r()()}if(n&2){let t=g();s(6),x(t.connectionError)}}function Pe(n,e){n&1&&(i(0,"div",20)(1,"div",21)(2,"mat-icon",22),a(3,"autorenew"),r()(),i(4,"h3"),a(5,"\uCC44\uD305 \uC5F0\uACB0 \uC911..."),r(),i(6,"p"),a(7,"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694"),r()())}function ye(n,e){n&1&&(i(0,"div",33)(1,"mat-icon"),a(2,"smart_toy"),r()())}function we(n,e){if(n&1&&(i(0,"div",28),d(1,ye,3,0,"div",29),i(2,"div",30),b(3,"div",31),i(4,"div",32),a(5),r()()()),n&2){let t=g().$implicit,o=g(2);s(),m("ngIf",t.senderType==="bot"),s(2),m("innerHTML",t.content,q),s(2),x(o.formatTime(t.createdAt))}}function Ie(n,e){if(n&1&&(i(0,"div",28)(1,"div",30)(2,"div",34),a(3),r(),i(4,"div",32),a(5),r()()()),n&2){let t=g().$implicit,o=g(2);s(3),x(t.content),s(2),x(o.formatTime(t.createdAt))}}function ke(n,e){if(n&1&&(i(0,"div",26),d(1,we,6,3,"div",27)(2,Ie,6,2,"div",27),r()),n&2){let t=e.$implicit;H("user-message",t.senderType==="client")("bot-message",t.senderType==="bot")("system-message",t.senderType==="system"),s(),m("ngIf",t.senderType!=="client"),s(),m("ngIf",t.senderType==="client")}}function Se(n,e){n&1&&(i(0,"div",35)(1,"div",36),b(2,"span")(3,"span")(4,"span"),r()())}function Ee(n,e){if(n&1&&(i(0,"div",23),d(1,ke,3,8,"div",24)(2,Se,5,0,"div",25),r()),n&2){let t=g();s(),m("ngForOf",t.messages),s(),m("ngIf",t.isLoading)}}function Te(n,e){if(n&1){let t=M();i(0,"button",39),_("click",function(){let c=u(t).$implicit,l=g(2);return C(l.selectQuickReply(c))}),a(1),r()}if(n&2){let t=e.$implicit;s(),O(" ",t," ")}}function Re(n,e){if(n&1&&(i(0,"div",37),d(1,Te,2,1,"button",38),r()),n&2){let t=g();s(),m("ngForOf",t.quickReplies)}}var D=class n{constructor(e,t,o,c,l){this.route=e;this.router=t;this.chatBotService=o;this.apiService=c;this.socketService=l}chatContainer;storeId="";storeName="";roomId=null;clientId=null;organizationId="1";isNewChat=!1;messages=[];newMessage="";welcomeMessage="";showQuickReplies=!0;quickReplies=[];isLoading=!1;isConnecting=!1;connectionError=null;currentTime=new Date;destroy$=new y;ngOnInit(){return h(this,null,function*(){this.route.queryParams.pipe(v(this.destroy$)).subscribe(e=>h(this,null,function*(){this.storeId=e.storeId||"",this.storeName=e.storeName||"\uC2A4\uD1A0\uC5B4",this.roomId=e.roomId||null,this.isNewChat=e.isNew==="true",this.isNewChat?yield this.initNewChat():this.roomId&&this.loadExistingChat()})),this.quickReplies=this.chatBotService.getQuickReplies(),yield this.connectWebSocket()})}ngAfterViewChecked(){this.scrollToBottom()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initNewChat(){return h(this,null,function*(){this.isConnecting=!0,this.connectionError=null,console.log("\u{1F680} \uCC44\uD305 \uCD08\uAE30\uD654 \uC2DC\uC791..."),console.log("- organizationId:",this.organizationId),console.log("- storeId:",this.storeId),console.log("- storeName:",this.storeName);try{console.log("\u{1F4DD} 1\uB2E8\uACC4: \uBE0C\uB77C\uC6B0\uC800 \uD551\uAC70\uD504\uB9B0\uD2B8 \uC0DD\uC131 \uC911...");let e=this.generateFingerprint();console.log("\u2705 \uD551\uAC70\uD504\uB9B0\uD2B8 \uC0DD\uC131 \uC644\uB8CC:",e),console.log("\u{1F4DD} 2\uB2E8\uACC4: \uACE0\uAC1D \uC2DD\uBCC4 API \uD638\uCD9C \uC911...");let t={fingerprintData:e,pluginKey:this.organizationId};console.log("- \uC694\uCCAD \uB370\uC774\uD130:",t);let o=yield this.apiService.identifyCustomerWithObject(t).toPromise();if(!o||!o.client)throw new Error("\uACE0\uAC1D \uC2DD\uBCC4 API \uC751\uB2F5\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");this.clientId=o.client.id,console.log("\u2705 \uACE0\uAC1D \uC2DD\uBCC4 \uC644\uB8CC:",this.clientId),console.log("\u{1F4DD} 3\uB2E8\uACC4: \uCC44\uD305\uBC29 \uC0DD\uC131 API \uD638\uCD9C \uC911...");let c={clientId:this.clientId,organizationId:this.organizationId};console.log("- \uC694\uCCAD \uB370\uC774\uD130:",c);let l=yield this.apiService.createRoomWithOrganization(c).toPromise();if(!l)throw new Error("\uCC44\uD305\uBC29 \uC0DD\uC131 API \uC751\uB2F5\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");this.roomId=l.id,console.log("\u2705 \uCC44\uD305\uBC29 \uC0DD\uC131 \uC644\uB8CC:",this.roomId),console.log("\u{1F4DD} 4\uB2E8\uACC4: \uD658\uC601 \uBA54\uC2DC\uC9C0 \uD45C\uC2DC"),this.welcomeMessage=`${this.storeName}\uC5D0 \uC624\uC2E0 \uAC83\uC744 \uD658\uC601\uD569\uB2C8\uB2E4! \uBB34\uC5C7\uC744 \uB3C4\uC640\uB4DC\uB9B4\uAE4C\uC694?`,this.currentTime=new Date,this.showQuickReplies=!0;let p={id:"welcome",roomId:this.roomId||"",senderType:"bot",content:this.welcomeMessage,createdAt:new Date};this.messages=[p],console.log("\u{1F4DD} 5\uB2E8\uACC4: WebSocket \uBC29 \uCC38\uAC00 \uC911..."),yield this.joinRoom(),this.isConnecting=!1,console.log("\u{1F389} \uCC44\uD305 \uCD08\uAE30\uD654 \uC644\uB8CC!")}catch(e){console.error("\u274C \uCC44\uD305 \uC2DC\uC791 \uC2E4\uD328:",e),console.error("\u274C \uC5D0\uB7EC \uC0C1\uC138:",{message:e.message,status:e.status,error:e.error,stack:e.stack}),this.connectionError="\uCC44\uD305\uC744 \uC2DC\uC791\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",e.status===404?this.connectionError="\uCC44\uD305 \uC11C\uBE44\uC2A4\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uAD00\uB9AC\uC790\uC5D0\uAC8C \uBB38\uC758\uD574\uC8FC\uC138\uC694.":e.status===500?this.connectionError="\uC11C\uBC84 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.":e.status===0?this.connectionError="\uC11C\uBC84\uC5D0 \uC5F0\uACB0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uB124\uD2B8\uC6CC\uD06C \uC5F0\uACB0\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.":e.error?.message&&(this.connectionError=`\uC624\uB958: ${e.error.message}`),this.isConnecting=!1}})}generateFingerprint(){let e=window.navigator,t=window.screen;return{userAgent:e.userAgent,language:e.language,platform:e.platform,screen:`${t.width}x${t.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,canvas:this.generateCanvasFingerprint(),memory:e.deviceMemory||"unknown",cores:e.hardwareConcurrency||"unknown",cookieEnabled:e.cookieEnabled,doNotTrack:e.doNotTrack||"unspecified",timestamp:Date.now()}}generateCanvasFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillText("Browser Fingerprint",10,10),e.toDataURL().substring(0,100)):"no-canvas"}catch{return"canvas-error"}}connectWebSocket(){return h(this,null,function*(){try{yield this.socketService.connect(),console.log("\u2705 WebSocket \uC5F0\uACB0 \uC644\uB8CC"),this.socketService.onEvent("newMessage").pipe(v(this.destroy$)).subscribe(e=>{e.roomId===this.roomId&&this.handleNewMessage(e.message)})}catch(e){console.error("\u274C WebSocket \uC5F0\uACB0 \uC2E4\uD328:",e)}})}joinRoom(){return h(this,null,function*(){!this.roomId||!this.clientId||(this.socketService.emitEvent("joinRoom",{roomId:this.roomId,clientId:this.clientId}),console.log("\u2705 \uBC29 \uCC38\uAC00 \uC644\uB8CC:",this.roomId))})}handleNewMessage(e){let t=V(F({},e),{status:"sent"});this.messages.push(t)}loadExistingChat(){this.isLoading=!0,this.isLoading=!1}sendMessage(e){return h(this,null,function*(){e&&e.preventDefault();let t=this.newMessage.trim();if(!t||!this.roomId)return;let o={id:`temp-${Date.now()}`,roomId:this.roomId,senderType:"client",content:t,createdAt:new Date,status:"pending"};this.messages.push(o),this.newMessage="";try{this.socketService.emitEvent("sendMessage",{roomId:this.roomId,content:t,senderType:"client"}),o.status="sent",this.showQuickReplies&&(yield this.processBotResponse(t))}catch(c){console.error("\u274C \uBA54\uC2DC\uC9C0 \uC804\uC1A1 \uC2E4\uD328:",c),o.status="failed"}})}processBotResponse(e){return h(this,null,function*(){setTimeout(()=>h(this,null,function*(){let t=yield this.chatBotService.processMessage(e),o={id:`bot-${Date.now()}`,roomId:this.roomId||"",senderType:"bot",content:t.message,createdAt:new Date};this.messages.push(o),t.action==="connectAgent"&&this.connectToAgent(),t.quickReplies&&(this.quickReplies=t.quickReplies)}),1e3)})}selectQuickReply(e){this.newMessage=e,this.sendMessage()}connectToAgent(){if(console.log("\uC0C1\uB2F4\uC6D0 \uC5F0\uACB0 \uC694\uCCAD"),!this.roomId){console.error("roomId\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");return}this.socketService.emitEvent("requestSupport",{roomId:this.roomId}),this.showQuickReplies=!1;let e={id:`system-${Date.now()}`,roomId:this.roomId,senderType:"system",content:"\uC0C1\uB2F4\uC6D0\uC5D0\uAC8C \uC5F0\uACB0 \uC911\uC785\uB2C8\uB2E4. \uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694...",createdAt:new Date};this.messages.push(e)}goBack(){this.router.navigate(["/chat-talk/client/home"],{queryParams:{storeId:this.storeId}})}onInputChange(){let e=document.querySelector("textarea");e&&this.autoResizeTextarea(e)}onEnterPress(e){e.shiftKey||(e.preventDefault(),this.sendMessage())}autoResizeTextarea(e){e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}scrollToBottom(){try{this.chatContainer&&(this.chatContainer.nativeElement.scrollTop=this.chatContainer.nativeElement.scrollHeight)}catch(e){console.error("Scroll error:",e)}}formatTime(e){return new Date(e).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||n)(f(T),f(R),f(he),f(ue),f(Ce))};static \u0275cmp=I({type:n,selectors:[["app-chat-client"]],viewQuery:function(t,o){if(t&1&&L(be,5),t&2){let c;j(c=$())&&(o.chatContainer=c.first)}},standalone:!1,decls:28,vars:7,consts:[["chatMessages",""],[1,"chat-container"],[1,"chat-header"],[1,"back-btn",3,"click"],[1,"header-info"],[1,"status-text"],[1,"menu-btn"],[1,"messages-container"],["class","connection-error",4,"ngIf"],["class","connecting-state",4,"ngIf"],["class","messages-list",4,"ngIf"],["class","quick-replies",4,"ngIf"],[1,"input-container"],[1,"input-form",3,"submit"],["type","button","matTooltip","\uD30C\uC77C \uCCA8\uBD80",1,"attach-btn"],["name","message","placeholder","\uBA54\uC2DC\uC9C0\uB97C \uC785\uB825\uD558\uC138\uC694...","rows","1",1,"message-input",3,"ngModelChange","input","keydown.enter","ngModel"],["type","submit","matTooltip","\uC804\uC1A1",1,"send-btn",3,"disabled"],[1,"connection-error"],[1,"error-icon"],["mat-raised-button","","color","primary",3,"click"],[1,"connecting-state"],[1,"spinner-wrapper"],[1,"spin"],[1,"messages-list"],["class","message-wrapper",3,"user-message","bot-message","system-message",4,"ngFor","ngForOf"],["class","loading-message",4,"ngIf"],[1,"message-wrapper"],["class","message-bubble",4,"ngIf"],[1,"message-bubble"],["class","message-avatar",4,"ngIf"],[1,"message-content"],[1,"message-text",3,"innerHTML"],[1,"message-time"],[1,"message-avatar"],[1,"message-text"],[1,"loading-message"],[1,"typing-indicator"],[1,"quick-replies"],["class","quick-reply-btn",3,"click",4,"ngFor","ngForOf"],[1,"quick-reply-btn",3,"click"]],template:function(t,o){if(t&1){let c=M();i(0,"div",1)(1,"div",2)(2,"button",3),_("click",function(){return u(c),C(o.goBack())}),i(3,"mat-icon"),a(4,"arrow_back"),r()(),i(5,"div",4)(6,"h2"),a(7,"\uACE0\uAC1D \uC0C1\uB2F4"),r(),i(8,"p",5),a(9),r()(),i(10,"button",6)(11,"mat-icon"),a(12,"more_vert"),r()()(),i(13,"div",7,0),d(15,Oe,11,1,"div",8)(16,Pe,8,0,"div",9)(17,Ee,3,2,"div",10),r(),d(18,Re,2,1,"div",11),i(19,"div",12)(20,"form",13),_("submit",function(p){return u(c),C(o.sendMessage(p))}),i(21,"button",14)(22,"mat-icon"),a(23,"attach_file"),r()(),i(24,"textarea",15),Y("ngModelChange",function(p){return u(c),W(o.newMessage,p)||(o.newMessage=p),C(p)}),_("input",function(){return u(c),C(o.onInputChange())})("keydown.enter",function(p){return u(c),C(o.onEnterPress(p))}),r(),i(25,"button",16)(26,"mat-icon"),a(27,"send"),r()()()()()}t&2&&(s(9),O(" ",o.showQuickReplies?"\uCC57\uBD07 \uC751\uB2F5":"\uC0C1\uB2F4\uC6D0 \uC5F0\uACB0\uB428"," "),s(6),m("ngIf",o.connectionError),s(),m("ngIf",o.isConnecting&&!o.connectionError),s(),m("ngIf",!o.connectionError&&!o.isConnecting),s(),m("ngIf",o.showQuickReplies&&o.quickReplies.length>0),s(6),Q("ngModel",o.newMessage),s(),m("disabled",!o.newMessage.trim()))},dependencies:[S,E,ee,K,U,Z,X,J,oe,B,ge],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#f5f5f5}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;background:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 2px 4px #0000000d}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%], .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:50%;transition:background .2s}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover, .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#333}.chat-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]{flex:1;margin:0 12px}.chat-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#333}.chat-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{margin:2px 0 0;font-size:12px;color:#667eea}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:24px;text-align:center}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#f44336;margin-bottom:16px}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#333;font-size:20px;font-weight:600}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 24px;color:#666;font-size:14px;max-width:300px;line-height:1.5}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:140px}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:24px;text-align:center}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   .spinner-wrapper[_ngcontent-%COMP%]{margin-bottom:16px}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   .spinner-wrapper[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#667eea}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#333;font-size:18px;font-weight:600}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.messages-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.message-wrapper[_ngcontent-%COMP%]{display:flex}.message-wrapper.user-message[_ngcontent-%COMP%]{justify-content:flex-end}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{flex-direction:row-reverse}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#667eea;color:#fff}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fffc}.message-wrapper.bot-message[_ngcontent-%COMP%], .message-wrapper.system-message[_ngcontent-%COMP%]{justify-content:flex-start}.message-wrapper.system-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;font-size:14px;text-align:center}.message-bubble[_ngcontent-%COMP%]{display:flex;gap:8px;max-width:70%}.message-bubble[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#667eea;display:flex;align-items:center;justify-content:center;flex-shrink:0}.message-bubble[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff;font-size:20px;width:20px;height:20px}.message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 1px 2px #0000001a}.message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{font-size:14px;line-height:1.5;white-space:pre-wrap;word-break:break-word}.message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{font-size:11px;color:#999;margin-top:4px}.loading-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.typing-indicator[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:12px 16px;display:flex;gap:4px}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;background:#999;border-radius:50%;animation:_ngcontent-%COMP%_typing 1.4s infinite}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_typing{0%,60%,to{transform:translateY(0);opacity:.7}30%{transform:translateY(-10px);opacity:1}}.quick-replies[_ngcontent-%COMP%]{padding:8px 16px;background:#fff;border-top:1px solid #e0e0e0;display:flex;gap:8px;overflow-x:auto;flex-wrap:wrap}.quick-replies[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.quick-replies[_ngcontent-%COMP%]   .quick-reply-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#fff;border:1px solid #667eea;color:#667eea;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;transition:all .2s}.quick-replies[_ngcontent-%COMP%]   .quick-reply-btn[_ngcontent-%COMP%]:hover{background:#667eea;color:#fff}.input-container[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #e0e0e0;padding:12px 16px}.input-form[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%], .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:50%;transition:background .2s;flex-shrink:0}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]:hover:not(:disabled), .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#f5f5f5}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]:disabled, .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#667eea}.input-form[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]{flex:1;border:1px solid #e0e0e0;border-radius:20px;padding:10px 16px;font-size:14px;font-family:inherit;resize:none;max-height:120px;outline:none}.input-form[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]:focus{border-color:#667eea}.input-form[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]::placeholder{color:#999}.input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-45deg)}"]})};function Be(n,e){if(n&1&&(i(0,"span",17),a(1),r()),n&2){let t=g().$implicit;s(),O(" ",t.unreadCount," ")}}function De(n,e){if(n&1){let t=M();i(0,"div",10),_("click",function(){let c=u(t).$implicit,l=g(2);return C(l.openChatRoom(c))}),i(1,"div",11)(2,"mat-icon"),a(3,"chat_bubble"),r(),d(4,Be,2,1,"span",12),r(),i(5,"div",13)(6,"div",14),a(7),r(),i(8,"div",15),a(9),r()(),i(10,"mat-icon",16),a(11,"chevron_right"),r()()}if(n&2){let t=e.$implicit,o=g(2);s(4),m("ngIf",t.unreadCount&&t.unreadCount>0),s(3),x(o.getRoomStatusText(t.status)),s(2),x(o.formatTime(t.lastMessageAt))}}function Ae(n,e){if(n&1&&(i(0,"div",7)(1,"h2"),a(2,"\uC774\uC804 \uB300\uD654"),r(),i(3,"div",8),d(4,De,12,3,"div",9),r()()),n&2){let t=g();s(4),m("ngForOf",t.chatRooms)}}function Ne(n,e){n&1&&(i(0,"div",18),b(1,"mat-spinner",19),r())}function ze(n,e){n&1&&(i(0,"div",20)(1,"mat-icon"),a(2,"chat_bubble_outline"),r(),i(3,"p"),a(4,"\uC544\uC9C1 \uB300\uD654 \uB0B4\uC5ED\uC774 \uC5C6\uC2B5\uB2C8\uB2E4"),r(),i(5,"p",21),a(6,"\uC0C8 \uBB38\uC758\uB97C \uC2DC\uC791\uD574\uBCF4\uC138\uC694!"),r()())}var A=class n{constructor(e,t){this.router=e;this.route=t}storeId="";chatRooms=[];isLoading=!1;destroy$=new y;ngOnInit(){this.route.queryParams.pipe(v(this.destroy$)).subscribe(e=>{this.storeId=e.storeId||"",this.storeId&&this.loadChatRooms()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadChatRooms(){this.isLoading=!0,this.chatRooms=[],this.isLoading=!1}startNewChat(){this.router.navigate(["/chat-talk/client/chat"],{queryParams:{storeId:this.storeId,isNew:!0}})}openChatRoom(e){this.router.navigate(["/chat-talk/client/chat"],{queryParams:{storeId:this.storeId,roomId:e.id}})}getRoomStatusText(e){return{bot_active:"\uCC57\uBD07 \uC751\uB2F5",waiting_agent:"\uC0C1\uB2F4\uC6D0 \uB300\uAE30\uC911",agent_active:"\uC0C1\uB2F4 \uC9C4\uD589\uC911",resolved:"\uC644\uB8CC",closed:"\uC885\uB8CC"}[e]||e}formatTime(e){if(!e)return"";let o=new Date().getTime()-new Date(e).getTime(),c=Math.floor(o/(1e3*60)),l=Math.floor(o/(1e3*60*60)),p=Math.floor(o/(1e3*60*60*24));return c<1?"\uBC29\uAE08 \uC804":c<60?`${c}\uBD84 \uC804`:l<24?`${l}\uC2DC\uAC04 \uC804`:p<7?`${p}\uC77C \uC804`:new Date(e).toLocaleDateString()}static \u0275fac=function(t){return new(t||n)(f(R),f(T))};static \u0275cmp=I({type:n,selectors:[["app-chat-client-home"]],standalone:!1,decls:17,vars:3,consts:[[1,"chat-home-container"],[1,"home-header"],[1,"home-content"],[1,"new-chat-btn",3,"click"],["class","chat-history",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"chat-history"],[1,"room-list"],["class","room-item",3,"click",4,"ngFor","ngForOf"],[1,"room-item",3,"click"],[1,"room-icon"],["class","unread-badge",4,"ngIf"],[1,"room-info"],[1,"room-status"],[1,"room-time"],[1,"arrow-icon"],[1,"unread-badge"],[1,"loading-container"],["diameter","40"],[1,"empty-state"],[1,"empty-sub"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"h1")(3,"mat-icon"),a(4,"chat"),r(),a(5," \uACE0\uAC1D \uC0C1\uB2F4 "),r(),i(6,"p"),a(7,"\uBB34\uC5C7\uC744 \uB3C4\uC640\uB4DC\uB9B4\uAE4C\uC694?"),r()(),i(8,"div",2)(9,"button",3),_("click",function(){return o.startNewChat()}),i(10,"mat-icon"),a(11,"add_comment"),r(),i(12,"span"),a(13,"\uC0C8 \uBB38\uC758\uD558\uAE30"),r()(),d(14,Ae,5,1,"div",4)(15,Ne,2,0,"div",5)(16,ze,7,0,"div",6),r()()),t&2&&(s(14),m("ngIf",o.chatRooms.length>0),s(),m("ngIf",o.isLoading),s(),m("ngIf",!o.isLoading&&o.chatRooms.length===0))},dependencies:[S,E,B,me],styles:[".chat-home-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px;height:100vh;display:flex;flex-direction:column}.home-header[_ngcontent-%COMP%]{text-align:center;padding:20px 0}.home-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;font-size:24px;font-weight:600;margin:0 0 10px}.home-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px}.home-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin:0}.home-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.new-chat-btn[_ngcontent-%COMP%]{width:100%;padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:30px;transition:transform .2s,box-shadow .2s}.new-chat-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.new-chat-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 16px #0003}.new-chat-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.chat-history[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0 0 15px;color:#333}.room-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.room-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px;background:#fff;border:1px solid #e0e0e0;border-radius:8px;cursor:pointer;transition:all .2s}.room-item[_ngcontent-%COMP%]:hover{background:#f5f5f5;border-color:#667eea}.room-item[_ngcontent-%COMP%]   .room-icon[_ngcontent-%COMP%]{position:relative;margin-right:15px}.room-item[_ngcontent-%COMP%]   .room-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px;color:#667eea}.room-item[_ngcontent-%COMP%]   .room-icon[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background:#f44;color:#fff;border-radius:10px;padding:2px 6px;font-size:11px;font-weight:600;min-width:18px;text-align:center}.room-item[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]{flex:1}.room-item[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]   .room-status[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#333;margin-bottom:4px}.room-item[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]   .room-time[_ngcontent-%COMP%]{font-size:12px;color:#999}.room-item[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{color:#ccc}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:40px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#999}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:20px;opacity:.3}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:10px 0;font-size:16px}.empty-state[_ngcontent-%COMP%]   .empty-sub[_ngcontent-%COMP%]{font-size:14px;color:#bbb}"]})};var Fe=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:A},{path:"chat",component:D}],N=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=k({type:n});static \u0275inj=w({imports:[P.forChild(Fe),P]})};var fe=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=k({type:n});static \u0275inj=w({imports:[G,P,N,te,ne,ie,ce,re,ae,pe,le,se,de]})};export{fe as ChatTalkClientModule};
