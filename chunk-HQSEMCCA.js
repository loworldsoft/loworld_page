import{h as f,i as y,o as D}from"./chunk-ORS73STK.js";import{Ia as b}from"./chunk-3HC7CDKU.js";import{a as d,b as g,ua as p}from"./chunk-TH5CS6OC.js";import{O as u,a as m,b as S,l as c,ma as h}from"./chunk-6NI24FLG.js";var v=class{constructor(){this.http=h(g),this.memershipService=h(b),this.diaryVM=h(D),this.todaySchedule$=new c(null),this.projectSchedules$=new c(null),this.scheduleRatio$=new c(null),this.scheduleCompleteData$=new c(null),this.label={all:"\uC804\uCCB4 \uC5C5\uBB34",receive:"\uC811\uC218",progress:"\uC9C4\uD589",complete:"\uC644\uB8CC"}}getTodayScheduleFromServer(){let o=this.memershipService.user$.getValue().id,t=p.baseSyncUrl+"/diary/today",a=new d().set("userId",o);this.http.get(t,{params:a}).pipe(u(1)).subscribe(e=>{console.log("\uB370\uC774\uD130, ",e);let l=e.schedules?.map(s=>this.diaryVM.refineSchedule(s)).map(s=>S(m({},s),{label:this.label[s.status]})),n=e.calendars?.map(s=>this.diaryVM.refineCalendar(s)).map(s=>S(m({},s),{label:this.label[s.status]})),r=this.diaryVM.sortSchedule([...l,...n]);console.log("\uC815\uC81C\uB41C \uB370\uC774\uD130, ",r),this.todaySchedule$.next(r)})}getScheduleAnalysisData(o){let t=p.baseSyncUrl+"/schedule",a=new d().set("id",o);this.http.get(t,{params:a}).pipe(u(1)).subscribe(e=>{console.log("\uB370\uC774\uD130 \u3134\u3147\u3139\u3134\u3147\u3139, ",e),this.projectSchedules$.next(e);let l=this.getScheduleCount(e);this.scheduleRatio$.next(l)})}getScheduleCompleteData(){let o=p.baseSyncUrl+"/diary/static",t=new d().set("userId",this.memershipService.user$.getValue().id);this.http.get(o,{params:t}).pipe(u(1)).subscribe(a=>{console.log("\uC77C\uC815 \uC644\uB8CC \uB370\uC774\uD130, ",a);let e=this.generateStaticScheduleData(a);this.scheduleCompleteData$.next(e)})}getScheduleCount(o){if(!o){console.log("\uB300\uC2DC\uBCF4\uB4DC \uC2A4\uCF00\uC904 \uAC12 \uC5C6\uC74C");return}let t=[{count:0,status:"all",label:this.label.all,ratio:0},{count:0,status:"receive",label:this.label.receive,ratio:0},{count:0,status:"progress",label:this.label.progress,ratio:0},{count:0,status:"complete",label:this.label.complete,ratio:0}];o.forEach(e=>{let l=t.find(r=>r.status===e.status);l&&(l.count+=1);let n=t.find(r=>r.status==="all");n&&(n.count+=1)});let a=t.find(e=>e.status==="all")?.count||0;return t.forEach(e=>{e.ratio=a?e.count/a:0}),console.log("\uADF8\uB8F9\uD654\uB41C \uC2A4\uCF00\uC904: ",t),t}generateStaticScheduleData(o){let t=y("%Y-%m-%dT%H:%M:%S.%LZ"),a=f("%Y-%m-%d"),e=new Date,l=Array.from({length:30},(r,s)=>{let i=new Date;return i.setDate(e.getDate()-(29-s)),{date:i,count:0}}),n=o.map(r=>({date:t(r.date),count:+r.count}));return l.map(r=>{let s=n.find(i=>a(i.date)===a(r.date));return{date:r.date,count:s?s.count:0}})}};export{v as a};
