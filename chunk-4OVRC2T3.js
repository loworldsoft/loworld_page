import{u as c}from"./chunk-4DTSJNKC.js";import{Z as r,ba as a,o as i}from"./chunk-F2JKNDFL.js";import{e as n}from"./chunk-JKOY2XUY.js";var g=class o{constructor(t){this.http=t;this.loadChatbotConfig()}chatbotConfig=null;keywordResponseMap=new Map;noMatchCount=0;failureCount=0;loadChatbotConfig(){return n(this,null,function*(){try{this.chatbotConfig=yield i(this.http.get("/assets/json/chat-talk-config.json")),this.buildKeywordMap(),console.log("\u2705 \uCC57\uBD07 \uC124\uC815 \uB85C\uB4DC \uC644\uB8CC")}catch(t){console.error("\u274C \uCC57\uBD07 \uC124\uC815 \uB85C\uB4DC \uC2E4\uD328:",t),this.setDefaultConfig()}})}setDefaultConfig(){this.chatbotConfig={chatbot:{name:"\uC2A4\uD1A0\uC5B4 \uCC57\uBD07",description:"Store \uC804\uC6A9 \uACE0\uAC1D \uC0C1\uB2F4 \uCC57\uBD07",welcomeMessage:"\uC548\uB155\uD558\uC138\uC694! \uBB34\uC5C7\uC744 \uB3C4\uC640\uB4DC\uB9B4\uAE4C\uC694?",defaultResponses:{notFound:'\uC8C4\uC1A1\uD569\uB2C8\uB2E4. \uC815\uD655\uD55C \uB2F5\uBCC0\uC744 \uCC3E\uAE30 \uC5B4\uB824\uC6CC\uC694. \uC0C1\uB2F4\uC6D0 \uC5F0\uACB0\uC744 \uC6D0\uD558\uC2DC\uBA74 "\uC0C1\uB2F4\uC6D0"\uC774\uB77C\uACE0 \uB9D0\uC500\uD574 \uC8FC\uC138\uC694.',error:"\uC77C\uC2DC\uC801\uC778 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",transferToAgent:"\uC0C1\uB2F4\uC6D0\uC5D0\uAC8C \uC5F0\uACB0\uD574\uB4DC\uB9AC\uACA0\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694."}},quickReplies:["\uC0C1\uD488 \uBB38\uC758","\uC8FC\uBB38 \uC870\uD68C","\uBC30\uC1A1 \uBB38\uC758","\uC0C1\uB2F4\uC6D0 \uC5F0\uACB0"],responses:{greeting:{keywords:["\uC548\uB155","\uC548\uB155\uD558\uC138\uC694","\uCC98\uC74C"],message:"\uC548\uB155\uD558\uC138\uC694! \uBB34\uC5C7\uC744 \uB3C4\uC640\uB4DC\uB9B4\uAE4C\uC694?"},human_agent:{keywords:["\uC0C1\uB2F4\uC6D0","\uC0C1\uB2F4\uC0AC","\uC0AC\uB78C","\uC9C1\uC6D0","\uC5F0\uACB0"],message:"\uC0C1\uB2F4\uC6D0\uC5D0\uAC8C \uC5F0\uACB0\uD574\uB4DC\uB9AC\uACA0\uC2B5\uB2C8\uB2E4.",action:"connectAgent"}},chatFlow:{triggers:{keywords:["\uC0C1\uB2F4\uC6D0","\uC0C1\uB2F4\uC0AC","\uC0AC\uB78C"],failureCount:3,noMatchCount:2},humanHandoff:{message:"\uC0C1\uB2F4\uC6D0\uC5D0\uAC8C \uC5F0\uACB0\uD574\uB4DC\uB9AC\uACA0\uC2B5\uB2C8\uB2E4.",action:"connectAgent",endpoint:"/api/chat-talk/transfer-to-human"}}},this.buildKeywordMap()}buildKeywordMap(){this.chatbotConfig?.responses&&(Object.entries(this.chatbotConfig.responses).forEach(([t,e])=>{let s={message:e.message,action:e.action||null,quickReplies:this.chatbotConfig?.quickReplies||[]};e.keywords?.forEach(h=>{this.keywordResponseMap.set(h.toLowerCase(),s)})}),console.log(`\u{1F5FA}\uFE0F \uD0A4\uC6CC\uB4DC \uB9F5 \uC0DD\uC131 \uC644\uB8CC: ${this.keywordResponseMap.size}\uAC1C`))}processMessage(t){return n(this,null,function*(){this.chatbotConfig||(yield this.loadChatbotConfig());let e=this.normalizeMessage(t),s=this.findExactKeywordMatch(e);return s||(s=this.findPartialMatch(e)),s?(this.resetCounters(),s):this.handleNoMatch()})}normalizeMessage(t){return t.toLowerCase().trim().replace(/[^\w\sㄱ-ㅎㅏ-ㅣ가-힣]/g,"").replace(/\s+/g," ")}findExactKeywordMatch(t){return this.keywordResponseMap.get(t)||null}findPartialMatch(t){for(let[e,s]of this.keywordResponseMap.entries())if(t.includes(e)||e.includes(t))return s;return null}handleNoMatch(){this.noMatchCount++,this.failureCount++;let t=this.chatbotConfig,e=t.chatFlow.triggers;return this.failureCount>=e.failureCount||this.noMatchCount>=e.noMatchCount?(this.resetCounters(),{message:t.chatFlow.humanHandoff.message,action:t.chatFlow.humanHandoff.action,quickReplies:[]}):{message:t.chatbot.defaultResponses.notFound,quickReplies:t.quickReplies}}resetCounters(){this.noMatchCount=0,this.failureCount=0}getWelcomeMessage(){return this.chatbotConfig?.chatbot.welcomeMessage||"\uC548\uB155\uD558\uC138\uC694!"}getQuickReplies(){return this.chatbotConfig?.quickReplies||[]}static \u0275fac=function(e){return new(e||o)(a(c))};static \u0275prov=r({token:o,factory:o.\u0275fac,providedIn:"root"})};export{g as a};
