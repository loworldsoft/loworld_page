import{a as T,b as R,c as X,d as Zt,e as O,f as Gt}from"./chunk-TXJ5AKCE.js";import{a as re,b as ae,c as se,d as ce,e as bt,f as le,g as de}from"./chunk-KGLOOV2F.js";import{a as vt}from"./chunk-HQSEMCCA.js";import{c as Ft}from"./chunk-UBLTWCJ7.js";import{R as Ct,V as me,a as Ut,b as Ht,c as Rt,d as Ot,f as zt,g as qt,h as Wt,i as Kt,j as Jt,l as Qt,o as te,q as ee,s as ie,t as oe,u as Y,v as ne}from"./chunk-ARTN3UFO.js";import{a as H}from"./chunk-DE2QPC2X.js";import"./chunk-VUISPKI5.js";import"./chunk-R5FOAF2N.js";import{o as pe}from"./chunk-ORS73STK.js";import{E as v,H as S,I as pt,a as Bt,b as Et,c as Lt,y as Xt,z as Yt}from"./chunk-RUVVEFL4.js";import{B as Vt,Fa as Pt,Ga as jt,Ia as U,J as g,Ja as At,Ka as Nt,La as w,_a as dt,ea as E,fa as Dt,pa as Tt,qa as lt,ra as $t}from"./chunk-3HC7CDKU.js";import"./chunk-CARY4E7O.js";import{a as b,j as It,k as ct,l as Q,ua as L}from"./chunk-TH5CS6OC.js";import{Aa as h,Cb as C,Db as Mt,Eb as rt,Ha as z,Ib as V,Jb as q,K as it,Lb as W,Mb as K,Nb as l,O as yt,Ob as p,Pb as D,Tb as x,Wb as f,Yb as d,Zb as wt,_b as St,a as y,aa as _,b as I,bb as nt,fb as c,ga as _t,gb as k,gc as at,ha as P,hc as m,ic as M,jc as J,la as ot,ma as N,nd as st,qa as j,ra as F,s as tt,sb as kt,x as et,xb as B,za as u}from"./chunk-6NI24FLG.js";var ue=[{header:"SyncTalk",menu:[{icon:"list",name:"\uCC44\uD305",action:"/syncbi/chat"},{icon:"list",name:"\uD504\uB85C\uC81D\uD2B8",action:"/syncbi/project"},{icon:"calendar_month",name:"\uCE98\uB9B0\uB354",action:"/syncbi/calendar"},{icon:"schedule",name:"\uB2E4\uC774\uC5B4\uB9AC",action:"/syncbi/diary"},{icon:"support_agent",name:"\uCC44\uB110\uD1A1",action:"/syncbi/channeltalk"},{icon:"computer",name:"OS",action:"/syncbi/window"}]}];var mt=(()=>{class n{constructor(){this.selectedAction=null,this.bodyHeight=0}getBodyHeight(){return this.bodyHeight=window.innerHeight,`${this.bodyHeight}px`}getBodyHeightWithHeader(){return this.bodyHeight=window.innerHeight,`${this.bodyHeight-140}px`}getBodyHeightNumber(){return this.bodyHeight=window.innerHeight,this.bodyHeight}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275prov=_t({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ke=["*"];function Me(n,i){if(n&1){let t=x();l(0,"button",5),f("click",function(){u(t);let o=d();return h(o.clickMenu())}),l(1,"mat-icon"),m(2,"menu"),p()()}}function we(n,i){if(n&1){let t=x();l(0,"button",8),f("click",function(){u(t);let o=d().$implicit,r=d(2);return h(r.clickButton(o.action))}),m(1),p()}if(n&2){let t=d().$implicit;C("matTooltip",t.tooltip),c(),J(" ",t.name," ")}}function Se(n,i){if(n&1){let t=x();l(0,"button",8),f("click",function(){u(t);let o=d().$implicit,r=d(2);return h(r.clickButton(o.action))}),m(1),l(2,"mat-icon",9),m(3),p()()}if(n&2){let t=d().$implicit;C("matTooltip",t.tooltip),c(),J(" ",t.name," "),c(2),M(t.icon)}}function Ie(n,i){if(n&1){let t=x();l(0,"button",10),f("click",function(){u(t);let o=d().$implicit,r=d(2);return h(r.clickButton(o.action))}),l(1,"mat-icon",9),m(2),p()()}if(n&2){let t=d().$implicit;C("matTooltip",t.tooltip),c(2),M(t.icon)}}function Ve(n,i){if(n&1&&B(0,we,2,2,"button",6)(1,Se,4,3,"button",6)(2,Ie,3,2,"button",7),n&2){let t,e=i.$implicit;V((t=e.type)==="basic"?0:t==="textIcon"?1:t==="icon"?2:-1)}}function De(n,i){if(n&1&&W(0,Ve,3,1,null,null,q),n&2){let t=d();K(t.buttons)}}var fe=(()=>{class n{constructor(){this.backgroundColor="#060294",this.isLeftNeeded=!0,this.src="",this.name="",this.buttons=[],this.clickLeft=new z,this.clickRight=new z}clickButton(t){this.clickRight.emit(t)}clickMenu(){this.clickLeft.emit()}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=j({type:n,selectors:[["app-header"]],inputs:{backgroundColor:"backgroundColor",isLeftNeeded:"isLeftNeeded",src:"src",name:"name",buttons:"buttons"},outputs:{clickLeft:"clickLeft",clickRight:"clickRight"},ngContentSelectors:ke,decls:8,vars:4,consts:[[1,"glassmorphism"],["mat-icon-button","",2,"color","#fff","margin-right","10px"],[2,"width","30px","margin-right","5px",3,"src"],[2,"color","#fff"],[1,"example-spacer"],["mat-icon-button","",2,"color","#fff","margin-right","10px",3,"click"],["mat-button","",2,"color","white",3,"matTooltip"],["mat-icon-button","",2,"color","white",3,"matTooltip"],["mat-button","",2,"color","white",3,"click","matTooltip"],["matListIcon","",1,"mat-18"],["mat-icon-button","",2,"color","white",3,"click","matTooltip"]],template:function(e,o){e&1&&(wt(),l(0,"mat-toolbar",0),B(1,Me,3,0,"button",1),D(2,"img",2),l(3,"span",3),m(4),p(),D(5,"span",4),B(6,De,2,0),St(7),p()),e&2&&(c(),V(o.isLeftNeeded?1:-1),c(),C("src","./assets/svg/loworld3.svg",nt),c(2),M(o.name),c(2),V(o.buttons.length>0?6:-1))},dependencies:[E,At,Tt,lt,Pt],styles:['@charset "UTF-8";.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.glassmorphism[_ngcontent-%COMP%]{background:#fff3;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.3)}']})}}return n})();function Pe(n,i){if(n&1){let t=x();l(0,"div",3),f("click",function(o){u(t);let r=d().$implicit,a=d();return h(a.clickList(o,r.action))}),m(1),p()}if(n&2){let t=d().$implicit,e=d();rt("selected",e.layoutService.selectedAction===t.action),c(),M(t.header)}}function je(n,i){if(n&1&&(l(0,"div",2),D(1,"img",4),m(2),p()),n&2){let t=d().$implicit;c(),C("src","./assets/svg/loworld.svg",nt),c(),J(" ",t.header," ")}}function Fe(n,i){if(n&1){let t=x();l(0,"mat-list-item",6),f("click",function(o){let r=u(t).$implicit,a=d(3);return h(a.clickList(o,r.action))}),l(1,"mat-icon",7),m(2),p(),l(3,"div",8),m(4),p()()}if(n&2){let t=i.$implicit,e=d(3);c(),rt("selected",e.layoutService.selectedAction===t.action),c(),M(t.icon),c(),rt("selected",e.layoutService.selectedAction===t.action),c(),M(t.name)}}function Be(n,i){if(n&1&&W(0,Fe,5,6,"mat-list-item",5,q),n&2){let t=d().$implicit;K(t.menu)}}function Ee(n,i){if(n&1&&(l(0,"div",0),B(1,Pe,2,3,"div",1)(2,je,3,2,"div",2)(3,Be,2,0),p()),n&2){let t=i.$implicit;c(),V(t.action?1:2),c(2),V(t.menu?3:-1)}}var be=(()=>{class n{constructor(t,e){this.router=t,this.layoutService=e,this.list=[],this.listClick=new z}ngOnInit(){this.layoutService.selectedAction=this.router.url.split("?")[0]}clickList(t,e){t.stopPropagation(),this.listClick.emit(e),this.layoutService.selectedAction=e}static{this.\u0275fac=function(e){return new(e||n)(k(ct),k(mt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-list"]],inputs:{list:"list"},outputs:{listClick:"listClick"},decls:3,vars:0,consts:[[2,"margin","0 0 20px"],["mat-subheader","","matRipple","",1,"main","pointer-cursor",2,"margin","0","padding","10px 17px",3,"selected"],["mat-subheader","",2,"margin","0","padding","10px 17px","display","flex","align-items","center"],["mat-subheader","","matRipple","",1,"main","pointer-cursor",2,"margin","0","padding","10px 17px",3,"click"],[2,"width","30px","margin-right","5px",3,"src"],["matRipple",""],["matRipple","",3,"click"],["matListItemIcon","",1,"sub","pointer-cursor"],["matListItemTitle","",1,"sub","pointer-cursor"]],template:function(e,o){e&1&&(l(0,"mat-list"),W(1,Ee,4,2,"div",0,q),p()),e&2&&(c(),K(o.list))},dependencies:[E,Wt,Kt,qt,Jt,zt],styles:[".main[_ngcontent-%COMP%]{font-weight:500}.main.selected[_ngcontent-%COMP%]{color:#fff!important}.sub[_ngcontent-%COMP%]{font-weight:550}.sub.selected[_ngcontent-%COMP%]{color:#fff!important}.pointer-cursor[_ngcontent-%COMP%]{cursor:pointer}"]})}}return n})();var Ce=(()=>{class n extends Bt{constructor(t,e,o,r){super(),this.router=t,this.layoutService=e,this.membershipService=o,this.dialog=r,this.SyncBiSideMenu=ue,this.buttons=[]}ngOnInit(){this.membershipService.getUser().pipe(_(this.destroy$)).subscribe(t=>{t&&t.id?(this.buttons=[{icon:"person",action:"account",type:"icon",tooltip:"\uACC4\uC815 \uD655\uC778/\uBCC0\uACBD"},{icon:"logout",action:"logout",type:"icon"}],this.checkIfDesktop()&&this.buttons.push({icon:"smartphone",action:"simulator",type:"icon"})):this.buttons=[]})}checkIfDesktop(){let t=navigator.userAgent.toLowerCase();return!/android|iphone|ipad|ipod|blackberry|windows phone|opera mini|iemobile/.test(t)}clickList(t,e){this.router.navigate([t],{relativeTo:this.router.routerState.root.firstChild}),e.close()}action(t){console.log(`${t} \uBC84\uD2BC \uD074\uB9AD`),this[t]()}logout(){this.membershipService.logout()}account(){let t=this.dialog.open(Ft,{width:"500px",minWidth:"300px",maxWidth:"600px",data:{title:"\uACC4\uC815 \uAD00\uB9AC",user:this.membershipService.user$.getValue()}})}simulator(){let t=this.dialog.open(Ut,{width:"300px",height:"600px"})}static{this.\u0275fac=function(e){return new(e||n)(k(ct),k(mt),k(U),k(Vt))}}static{this.\u0275cmp=j({type:n,selectors:[["app-sync-bi"]],features:[kt],decls:13,vars:6,consts:[["drawer",""],[1,"container"],[1,"mat-drawer-container",3,"hasBackdrop"],["mode","side",1,"container-drawer"],[1,"drawer-header"],["mat-icon-button","",2,"float","right","margin-top","10px","margin-right","10px",3,"click"],[3,"listClick","list"],[1,"drawer-content"],[3,"clickLeft","clickRight","name","buttons"],[1,"component-container"]],template:function(e,o){if(e&1){let r=x();l(0,"div",1)(1,"mat-drawer-container",2)(2,"mat-drawer",3,0)(4,"div",4)(5,"button",5),f("click",function(){u(r);let s=at(3);return h(s.close())}),l(6,"mat-icon"),m(7,"close"),p()()(),l(8,"app-list",6),f("listClick",function(s){u(r);let $=at(3);return h(o.clickList(s,$))}),p()(),l(9,"mat-drawer-content",7)(10,"app-header",8),f("clickLeft",function(){u(r);let s=at(3);return h(s.toggle())})("clickRight",function(s){return u(r),h(o.action(s))}),p(),l(11,"div",9),D(12,"router-outlet"),p()()()()}e&2&&(Mt("height",o.layoutService.getBodyHeight()),c(),C("hasBackdrop",!0),c(7),C("list",o.SyncBiSideMenu),c(2),C("name","SyncTalk")("buttons",o.buttons))},dependencies:[lt,E,Rt,Ot,Ht,It,fe,be],styles:['@charset "UTF-8";[_nghost-%COMP%]{flex:1}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.mat-drawer-container[_ngcontent-%COMP%]{background:url(/assets/images/back.jpg) repeat center center fixed;background-size:cover;width:100%;height:100vh;transition:background-size .3s ease-in-out}.container-drawer[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#dddddd80;border-right:1px solid rgb(168,168,168);border-radius:0;width:300px}.drawer-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;height:100%}.component-container[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}']})}}return n})();var Ue=[{path:"",component:Ce,children:[{path:"",redirectTo:L.production?"login":"channeltalk",pathMatch:"full"},{path:"project",loadChildren:()=>import("./chunk-N5F4626Y.js").then(n=>n.ProjectModule)},{path:"chat",loadChildren:()=>import("./chunk-HVWLOF3I.js").then(n=>n.ChatModule)},{path:"calendar",loadChildren:()=>import("./chunk-LUJOYTLK.js").then(n=>n.CalendarModule)},{path:"diary",loadChildren:()=>import("./chunk-J27MH4L7.js").then(n=>n.DiaryModule)},{path:"dashboard",loadChildren:()=>import("./chunk-R4D3NAY6.js").then(n=>n.DashboardModule)},{path:"channeltalk",loadChildren:()=>import("./chunk-B4B7NVBC.js").then(n=>n.ChannelTalkModule)},{path:"login",loadChildren:()=>import("./chunk-E7B7YWOC.js").then(n=>n.MembershipModule)},{path:"window",loadChildren:()=>import("./chunk-TBRC2BUT.js").then(n=>n.WindowManagerModule)}]},{path:"**",redirectTo:"/chat"}],ve=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=P({imports:[Q.forChild(Ue),Q]})}}return n})();var ut=class extends S{constructor(){super(),this.membersipService=N(U),this.getProjectFromServer()}getDiagloData(i){return[{type:T,data:{control:this.dialogVM.createFormControl({key:"name",initValue:i?i.name:"",validators:[g.required]}),label:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984",placeholder:"\uC194\uB8E8\uC158 \uAD6C\uCD95",hint:"\uD504\uB85C\uC81D\uD2B8 \uC774\uB984\uC744 \uC791\uC131\uD574\uC8FC\uC138\uC694"}},{type:X,data:{control:this.dialogVM.createFormControl({key:"status",initValue:i?i.status:"",validators:[g.required]}),label:"\uD504\uB85C\uC81D\uD2B8 \uC0C1\uD0DC",options:[{value:w.Receive,label:"\uC811\uC218\uB428"},{value:w.Progress,label:"\uC9C4\uD589\uC911"},{value:w.Complete,label:"\uC644\uB8CC\uB428"}],hint:"\uD504\uB85C\uC81D\uD2B8 \uC77C\uC815\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}},{type:O,data:{date:{control:this.dialogVM.createFormControl({key:"startDate",initValue:i?i.startDate:new Date,validators:[g.required]}),label:"\uD504\uB85C\uC81D\uD2B8 \uC2DC\uC791 \uB0A0\uC9DC",hint:"\uD504\uB85C\uC81D\uD2B8 \uC2DC\uC791 \uB0A0\uC9DC\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694"},time:{label:"\uD504\uB85C\uC81D\uD2B8 \uC2DC\uC791 \uC2DC\uAC04",hint:"\uD504\uB85C\uC81D\uD2B8 \uC2DC\uC791 \uC2DC\uAC04\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}}},{type:O,data:{date:{control:this.dialogVM.createFormControl({key:"endDate",initValue:i?i.endDate:new Date,validators:[g.required]}),label:"\uD504\uB85C\uC81D\uD2B8 \uC885\uB8CC \uB0A0\uC9DC",hint:"\uD504\uB85C\uC81D\uD2B8 \uC885\uB8CC \uB0A0\uC9DC\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694"},time:{label:"\uD504\uB85C\uC81D\uD2B8 \uC885\uB8CC \uC2DC\uAC04",hint:"\uD504\uB85C\uC81D\uD2B8 \uC885\uB8CC \uC2DC\uAC04\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}}},i?void 0:{type:T,data:{control:this.dialogVM.createFormControl({key:"leader",initValue:this.membershipService.user$.getValue().id,validators:[g.required]}),label:"\uD504\uB85C\uC81D\uD2B8 \uB9AC\uB354",placeholder:"leader`s Id",hint:"\uB9AC\uB354\uC758 \uC544\uC774\uB514\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694"}},i?void 0:{type:Zt,data:{control:this.dialogVM.createFormControl({key:"members",initValue:[],validators:[]}),label:"\uBA64\uBC84",placeholder:"member`s Id",hint:"\uCD08\uB300\uD560 \uC0AC\uB78C\uC758 \uC544\uC774\uB514\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694"}},{type:T,data:{control:this.dialogVM.createFormControl({key:"description",initValue:i?i.description:"",validators:[]}),label:"\uD504\uB85C\uC81D\uD2B8 \uB0B4\uC6A9",placeholder:"\uD504\uB85C\uC81D\uD2B8 ANA \uC194\uB8E8\uC158 \uAD6C\uCD95",hint:"\uD504\uB85C\uC81D\uD2B8\uC5D0 \uB300\uD574 \uC124\uBA85\uD574\uC8FC\uC138\uC694"}},i?this.getUpdateButton(i):this.getCreateButton()].filter(Boolean)}getCreateButton(){return{type:R,data:[{type:v,data:{data:{text:"\uC0DD\uC131",icon:"save"},style:{marginTop:"10px",marginRight:"10px"},event:()=>{let i=this.createProject()}}},{type:v,data:{data:{text:"\uCDE8\uC18C",icon:"cancel"},style:{marginTop:"10px"},event:()=>{console.log("\uCDE8\uC18C \uBC84\uD2BC \uD074\uB9AD"),this.dialogVM.close()}}}]}}getUpdateButton(i){return{type:R,data:[{type:v,data:{data:{text:"\uC218\uC815",icon:"edit"},style:{marginRight:"10px"},event:()=>{let t=this.updateProject(i);this.dialogVM.close()}}},{type:v,data:{data:{text:"\uCDE8\uC18C",icon:"cancel"},style:{},event:()=>{console.log("\uCDE8\uC18C \uBC84\uD2BC \uD074\uB9AD"),this.dialogVM.close()}}}]}}createProject(){let i=this.createParam();if(!i)return;console.log("\uD30C\uB77C\uBBF8\uD130, ",i),this.dialogVM.close(),console.log("\uD604\uC7AC \uC18C\uCF13 \uC5F0\uACB0 \uC0C1\uD0DC, ",this.socketService.isConnected()),this.socketService.emitEvent("createInstance",i)}updateProject(i){let t=this.createParam();t.id=i.id,console.log("\uD504\uB85C\uC81D\uD2B8 \uC5C5\uB370\uC774\uD2B8 \uC2DC\uB3C4, ",t),this.socketService.emitEvent("updateInstance",t)}createParam(){let i=this.dialogVM.getControls();return i?(console.log("\uD30C\uB77C\uBBF8\uD130 \uC0DD\uC131"),{organizationId:this.membersipService.selectedOragnization.organizationId,name:i.find(e=>e.key==="name")?.control.value,status:i.find(e=>e.key==="status")?.control.value,startDate:i.find(e=>e.key==="startDate")?.control.value,endDate:i.find(e=>e.key==="endDate")?.control.value,leader:i.find(e=>e.key==="leader")?.control.value,members:i.find(e=>e.key==="members")?.control.value,description:i.find(e=>e.key==="description")?.control.value}):void 0}getProjectFromServer(){console.log("setData");let i=new b().set("userId",this.membersipService.user$.getValue().id);console.log("\uD504\uB85C\uC81D\uD2B8 \uC694\uCCAD \uACC4\uC815, ",this.membersipService.user$.getValue()),this.http.get(this.baseUrl,{params:i}).pipe(it(t=>tt(new Error("\uB370\uC774\uD130 \uCD08\uAE30\uD654 \uC911 \uC5D0\uB7EC \uBC1C\uC0DD")))).subscribe(t=>{console.log("\uD504\uB85C\uC81D\uD2B8 \uB370\uC774\uD130 \uBC1B\uC544\uC634, ",t),t.map(e=>{e.startDate=new Date(e.startDate),e.endDate=new Date(e.endDate)}),this.projects$.next(t)})}getProjects(){return this.projects$.asObservable()}getMembers(){return this.projectMembers$.asObservable()}getTotalMembers(){return this.projectMembers$.asObservable().pipe(et(i=>i.length))}leaveProject(i){let t="leaveInstance",e={userId:this.membersipService.user$.getValue().id,userName:this.membersipService.user$.getValue().name,projectId:i};this.socketService.emitEvent(t,e)}setSelectedProject(i){this.selectedProject$.next(i),console.log("\uD504\uB85C\uC81D\uD2B8 \uC120\uD0DD,",this.selectedProject$.getValue())}inviteMember(){this.getOrganizationMembersFromServer();let i=this.dialogVM.openInviteDialog();this.dialogRef=i;let t=i.componentInstance.output;this.subscription=t.pipe().subscribe({next:e=>{if(console.log("\uBC18\uD658\uAC12, ",e),e.length<1)return;let o=e.map(r=>r.id);this.createProjectPermissioin(o)},complete:()=>{console.log("\uC644\uB8CC\uB428")}})}getOrganizationMembersFromServer(){console.log("\uD604\uC7AC \uC870\uC9C1",this.membershipService.selectedOragnization);let i=this.membershipService.selectedOragnization.organizationId,t=new b().set("organizationId",i),e=L.baseSyncUrl+"/organization/members";this.http.get(e,{params:t}).subscribe(o=>{console.log("\uC870\uC9C1 \uAD6C\uC131\uC6D0, ",o),this.organizationMembers$.next([...o])})}createProjectPermissioin(i){let t=this.selectedProject$.getValue().id,e="createPermission",o={projectId:t,userIds:i};this.socketService.emitEvent(e,o)}};var ht=class extends H{constructor(){super()}loadInstances(){console.log("\uC778\uC2A4\uD134\uC2A4 \uB85C\uB4DC....................");let i=this.membershipService.user$.getValue(),t=new b().set("userId",i.id);this.http.get(`${this.baseUrl}/instances`,{params:t}).pipe(_(this.destroy$)).subscribe(e=>{console.log("loadInstances \uC644\uB8CC,",e),this.instances$.next([...e]),this.loadInstance(e[0]);let o="joinInstance";this.socketService.emitEvent(o,{userId:i.id,chatInstances:e});let r=a=>{console.log(`${o} \uC774\uBCA4\uD2B8 \uC2E4\uD589\uB428,`,a)};this.addEventListener(o,r)})}loadInstance(i){console.log("\uC120\uD0DD\uB41C \uC778\uC2A4\uD134\uC2A4",i);let t=new b().set("id",i?.id);this.http.get(`${this.baseUrl}/instance`,{params:t}).subscribe(e=>{console.log("\uC778\uC2A4\uD134\uC2A4 \uBC1B\uAE30 \uC131\uACF5, ",e),this.instance$.next(e)})}createInstance(i){this.socketService.emitEvent("createInstance",i)}updateInstance(i){let t="updateInstance",e={id:i.id,name:i.name,description:i.description};this.socketService.emitEvent(t,e)}createChat(){let i=this.createChatParam();if(this.isFileUploading){console.log("\uD30C\uC77C \uC5C5\uB85C\uB4DC\uC911");return}i.chatData=[...this.storedFiles],i.chatText=this.textForm.value,i.conversationId=this.instance$.getValue().id,console.log("\uC81C\uCD9C \uC804 \uD30C\uB77C\uBBF8\uD130, ",i),this.socketService.emitEvent("createChat",i);let e="createChatSucess",o=r=>{this.storedFiles=[],this.textForm.reset()};this.addEventListener(e,o)}deleteChat(i){console.log("\uC0AD\uC81C \uC694\uCCAD, ",i);let t="deleteChat",e=this.instance$.getValue().id,o=i.chatId;this.socketService.emitEvent(t,{chatId:o,instanceId:e})}createReaction(i,t){let e="createReaction",o=this.instance$.getValue().id,r=this.membershipService.user$.getValue().id,a={instanceId:o,chatId:i,userId:r,emoji:t};this.socketService.emitEvent(e,a)}deleteReaction(i,t){let e="deleteReaction",o=this.instance$.getValue().id,r=this.membershipService.user$.getValue().id,a={instanceId:o,chatId:i,userId:r,emoji:t};console.log("\uB9AC\uC561\uC158 \uC81C\uAC70 \uC694\uCCAD, ",a),this.socketService.emitEvent(e,a)}appendChat(i){console.log("appendChat \uD638\uCD9C",i);let t=[...this.instances$.getValue()],e=y({},this.instance$.getValue()),o=t.findIndex(r=>r.id===e.id);t[o]=I(y({},t[o]),{chats:[...t[o].chats,i]}),this.instances$.next([...t]),this.instance$.next(e),localStorage.setItem("joinedInstances",JSON.stringify(t))}toggle(){this.opened=!this.opened}onFileSelected(i){throw new Error("Method not implemented.")}uploadFile(i){this.isFileUploading=!0;let t=new FormData,e={chat:"",type:"",value:"",dataId:"",originalFileName:""};t.append("chatData",JSON.stringify(e));for(let o=0;o<i.length;o++){let r=i[o];t.append("file",i[o])}this.http.post(this.baseUrl+"/upload",t).subscribe({next:o=>{console.log("\uD30C\uC77C \uC5C5\uB85C\uB4DC \uC644\uB8CC, ",o),this.storedFiles=[...this.storedFiles,...o.result]},error:o=>{console.log(o)},complete:()=>{console.log("\uD30C\uC77C \uC5C5\uB85C\uB4DC \uC644\uB8CC \uD6C4 observer \uC885\uB8CC"),this.isFileUploading=!1}})}download(i){let t=i.dataId.split("_").pop(),e=`${this.baseUrl}/download?filePath=${i.value}`;window.location.href=e}openFileDialog(i){this.dialog.open(ae,{data:i,panelClass:"custom-dialog-panel",hasBackdrop:!1})}openDialog(){let i=this.dialog.open(se,{data:[{type:ne,data:{data:this.getInstance().pipe(et(t=>t.name)),buttonConfigs:[{type:ee,data:{icon:"close"},style:{},event:()=>{this.dialog.closeAll()}}]},style:{}},{type:ce,data:[{type:le,key:"\uC815\uBCF4",style:{},event:(t,e)=>{console.log("\uC815\uBCF4\uD0ED \uD074\uB9AD"),t.output.emit(e)},data:{data:[{type:bt,data:{label:"\uC8FC\uC81C",key:"name",content:this.instance$.getValue().name},event:(t,e)=>{let o=this.instance$.getValue();o[t]=e,console.log("\uC5C5\uB370\uC774\uD2B8 \uC694\uCCAD \uC804, ",o,"\uB370\uC774\uD130, ",e,"\uD0A4\uAC12, ",t),this.updateInstance(o)}},{type:bt,data:{label:"\uC124\uBA85",key:"description",content:this.instance$.getValue().description},event:(t,e)=>{let o=this.instance$.getValue();o[t]=e,this.updateInstance(o)}}],style:{borderRadius:"8px",margin:"10px",backgroundColor:"white"}}},{type:de,key:"\uBA64\uBC84",event:(t,e)=>{console.log("\uBA64\uBC84 \uD0ED \uD074\uB9AD")},data:{data:this.projectVM.projectMembers$.asObservable(),filterKey:"name",label:"\uBA64\uBC84 \uC774\uB984\uC744 \uC791\uC131\uD574\uC8FC\uC138\uC694"}}],style:{}},{type:re,data:{component:oe,data:{data:{text:"\uCC44\uD305\uBC29\uC5D0\uC11C \uB098\uAC00\uAE30",icon:"logout"},style:{},event:()=>{let t=this.confirm()}}},style:{}}],width:"400px",height:"500px",panelClass:"dynamic-dialog-panel",autoFocus:!1})}getConfirmDialogData(){return{toolbar:{data:"\uD504\uB85C\uC81D\uD2B8 \uB098\uAC00\uAE30",style:{}},text:"\uC815\uB9D0\uB85C \uD504\uB85C\uC81D\uD2B8\uC5D0\uC11C \uB098\uAC00\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",buttons:[{data:{text:"\uD655\uC778",icon:"check_circle"},style:{},event:()=>{this.confirmDialog?.close("confirm")}},{data:{text:"\uCDE8\uC18C",icon:"cancel"},style:{},event:()=>{this.confirmDialog?.close("cancel")}}]}}confirm(){this.confirmDialog=this.dialog.open(Xt,{data:this.getConfirmDialogData(),autoFocus:!1}),this.confirmDialog.afterClosed().pipe(yt(1)).subscribe(i=>{if(i){let t=this.instance$.getValue().id;this.projectVM.leaveProject(t),this.dialog.closeAll()}this.confirmDialog=void 0})}};var xe=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=P({imports:[st,Dt,Nt,$t,Qt,jt]})}}return n})();var Z=function(n){return n.High="HIGH",n.Medium="MEDIUM",n.Low="LOW",n}(Z||{}),xt=function(n){return n.User="USER",n.Project="PROJECT",n}(xt||{});var gt=class extends pt{getDialogData(i){return[{type:T,data:{control:this.dialogVM.createFormControl({key:"name",initValue:i?i.name:"",validators:[g.required]}),label:"\uC5C5\uBB34 \uC774\uB984",placeholder:"\uAE30\uB2A5 \uD1B5\uD569",hint:"\uC5C5\uBB34 \uC774\uB984\uC744 \uC791\uC131\uD574\uC8FC\uC138\uC694"}},{type:O,data:{date:{control:this.dialogVM.createFormControl({key:"startDate",initValue:i?i.startDate:new Date,validators:[g.required]}),label:"\uC5C5\uBB34 \uC2DC\uC791 \uB0A0\uC9DC",hint:"\uC5C5\uBB34 \uC2DC\uC791 \uB0A0\uC9DC\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694"},time:{label:"\uC5C5\uBB34 \uC2DC\uC791 \uC2DC\uAC04",hint:"\uC5C5\uBB34 \uC2DC\uC791 \uC2DC\uAC04\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}}},{type:O,data:{date:{control:this.dialogVM.createFormControl({key:"endDate",initValue:i?i.endDate:new Date,validators:[g.required]}),label:"\uC5C5\uBB34 \uC885\uB8CC \uB0A0\uC9DC",hint:"\uC5C5\uBB34\uBB34 \uC885\uB8CC \uB0A0\uC9DC\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694"},time:{label:"\uC5C5\uBB34 \uC885\uB8CC \uC2DC\uAC04",hint:"\uC5C5\uBB34 \uC885\uB8CC \uC2DC\uAC04\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}}},{type:Gt,data:{control:this.dialogVM.createFormControl({key:"managerId",initValue:i?i.manager.id:"",validators:[g.required]}),label:"\uB2F4\uB2F9\uC790",placeholder:"managerId",hint:"\uB2F4\uB2F9\uC790 \uC544\uC774\uB514\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694",check:t=>{let e=this.projectVM.projectMembers$.getValue();return console.log("\uD604\uC7AC \uBA64\uBC84, ",e),e.findIndex(r=>r.id===t)}}},{type:T,data:{control:this.dialogVM.createFormControl({key:"description",initValue:i?i.description:"",validators:[]}),label:"\uC5C5\uBB34 \uB0B4\uC6A9",placeholder:"\uC5EC\uD0DC \uB9CC\uB4E0 \uAE30\uB2A5\uB4E4 \uD1B5\uD569\uD558\uAE30",hint:"\uC5C5\uBB34\uC5D0 \uB300\uD574 \uC124\uBA85\uD574\uC8FC\uC138\uC694"}},{type:X,data:{control:this.dialogVM.createFormControl({key:"status",initValue:i?i.status:"",validators:[g.required]}),label:"\uC5C5\uBB34 \uC0C1\uD0DC",options:[{value:w.Receive,label:"\uC811\uC218"},{value:w.Progress,label:"\uC9C4\uD589\uC911"},{value:w.Complete,label:"\uC644\uB8CC"}],hint:"\uC5C5\uBB34 \uC0C1\uD0DC\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694"}},{type:X,data:{control:this.dialogVM.createFormControl({key:"priority",initValue:i?i.priority:"",validators:[g.required]}),label:"\uC5C5\uBB34 \uC911\uC694\uB3C4",options:[{value:Z.Low,label:"\uB0AE\uC74C"},{value:Z.Medium,label:"\uC911\uAC04"},{value:Z.High,label:"\uB192\uC74C"}],hint:"\uC5C5\uBB34 \uC911\uC694\uB3C4\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694"}},i?this.getUpdateButton(i):this.getCeateButton()]}getCeateButton(){return{type:R,data:[{type:v,data:{data:{text:"\uC0DD\uC131",icon:"save"},style:{},event:()=>{this.createTask()}}},{type:v,data:{data:{text:"\uCDE8\uC18C",icon:"cancel"},style:{},event:()=>{console.log("\uCDE8\uC18C \uBC84\uD2BC \uD074\uB9AD"),this.dialogVM.close()}}}]}}getUpdateButton(i){return{type:R,data:[{type:v,data:{data:{text:"\uC218\uC815",icon:"edit"},style:{},event:()=>{this.updateTask(i)}}},{type:v,data:{data:{text:"\uC81C\uAC70",icon:"delete"},style:{},event:()=>{this.deleteTask(i.id)}}},{type:v,data:{data:{text:"\uCDE8\uC18C",icon:"cancel"},style:{},event:()=>{console.log("\uCDE8\uC18C \uBC84\uD2BC \uD074\uB9AD"),this.dialogVM.close()}}}]}}constructor(){super(),this.MembershipService=N(U),this.projectVM=N(S),this.baseUrl=L.baseSyncUrl+"/schedule",this.initData()}initData(){this.initSibling(),this.projectVM.selectedProject$.subscribe(i=>{this.getTaskFromServer()})}initSibling(){localStorage.getItem("sibling")||(console.log("siblingString \uB0B4\uBD80 \uC2E4\uD589"),this.http.get(this.jsonUrl).subscribe(t=>{console.log("sibling \uC138\uD305 ",t.sibling),this.sibling.next(t.sibling)}))}getTaskFromServer(){console.log("setData \u3147\u3147\u3147");let i=new b().set("id",this.projectVM.selectedProject$.getValue().id);this.http.get(this.baseUrl,{params:i}).pipe(it(t=>tt(new Error("\uB370\uC774\uD130 \uCD08\uAE30\uD654 \uC911 \uC5D0\uB7EC \uBC1C\uC0DD")))).subscribe(t=>{console.log("\uC2A4\uCF00\uC904 \uCD08\uAE30 \uB370\uC774\uD130, ",t),t.map(e=>{e.startDate=new Date(e.startDate),e.endDate=new Date(e.endDate)}),this.tasks.next(t??[])})}updateTasks(i,t){let o=this.tasks.getValue().filter(r=>r.status!==i);this.tasks.next([...t,...o])}createTask(){let i=this.createParam();i&&(console.log("\uC694\uCCAD , ",i),this.http.post(this.baseUrl,i).subscribe(t=>{console.log("\uACB0\uACFC , ",t),this.dialogVM.close(),console.log("tasks\uB294 ??? ",this.tasks.getValue());let e=this.tasks.getValue();e.push(t),this.tasks.next([...e])}))}updateTask(i){let t=this.createParam();if(!t)return;console.log("\uC5C5\uB370\uC774\uD2B8 \uD638\uCD9C");let e=i.id,o=this.tasks.getValue(),r=o.findIndex(s=>s.id===e),a=o[r];a.name=t.name,a.status=t.status,a.startDate=t.startDate,a.endDate=t.endDate,a.managerId=t.managerId,a.status=t.status,a.priority=t.priority,a.description=t.description,this.http.patch(this.baseUrl,a).subscribe(s=>{console.log("\uC5C5\uB370\uC774\uD2B8 \uC131\uACF5, ",s);let $=s,ye=[...o.slice(0,r),$,...o.slice(r+1)];this.scheduleUpdateEmitter.emit($),this.tasks.next(ye),this.dialogVM.close()})}updateTaskStatus(i,t){let e=this.tasks.getValue(),o=e.findIndex(s=>s.id===i);if(o<0)return;let r=I(y({},e[o]),{status:t}),a=[...e.slice(0,o),r,...e.slice(o+1)];this.tasks.next(a)}deleteTask(i){let t=new b().set("id",i);this.http.delete(this.baseUrl,{params:t}).subscribe(e=>{if(e.affected<1){console.log("\uC81C\uAC70 \uC2E4\uD328, ",e);return}console.log("\uC81C\uAC70 \uC131\uACF5, ",e);let o=this.tasks.getValue().filter(r=>r.id!==i);this.scheduleDeleteEmitter.emit(i),this.tasks.next(o),this.dialogVM.close()})}drop(i){console.log("\uB4DC\uB86D\uC774\uBCA4\uD2B8",i);let t=i.previousContainer.id,e=i.container.id;console.log("\uC774\uC804",t),console.log("\uD604\uC7AC",e);let o=this.tasks.getValue(),r=o.filter(s=>s.status===t),a=o.filter(s=>s.status===e);if(console.log("\uC774\uC804 \uB370\uC774\uD130",r),console.log("\uD604\uC7AC \uB370\uC774\uD130",a),i.previousContainer===i.container){console.log("\uAC19\uC740 \uB9AC\uC2A4\uD2B8"),Et(r,i.previousIndex,i.currentIndex),this.updateTasks(t,r);return}else{console.log("\uB2E4\uB978 \uB9AC\uC2A4\uD2B8");let s=r[i.previousIndex];s.status=e,console.log("\uBC14\uB010 \uC0C1\uD0DC, ",s),this.http.patch(this.baseUrl,s).subscribe($=>{console.log("\uC0C1\uD0DC \uC5C5\uB370\uC774\uD2B8 \uC131\uACF5, ",$),Lt(r,a,i.previousIndex,i.currentIndex),this.updateTasks(t,r),this.updateTasks(e,a)})}}createParam(){let i=this.dialogVM.getControls();return console.log("fffffffffffffff",i),i?(console.log("asdfasdf"),{ownerId:this.projectVM.selectedProject$.getValue().id,ownerType:xt.Project,name:i.find(e=>e.key==="name")?.control.value,startDate:i.find(e=>e.key==="startDate")?.control.value,endDate:i.find(e=>e.key==="endDate")?.control.value,managerId:i.find(e=>e.key==="managerId")?.control.value,description:i.find(e=>e.key==="description")?.control.value,status:i.find(e=>e.key==="status")?.control.value,priority:i.find(e=>e.key==="priority")?.control.value}):void 0}};var ft=class extends dt{constructor(){super(),this.checkDate(),this.initData(),this.syncData()}initData(){let i=new b().set("userId",this.membershipService.user$.getValue().id);this.http.get(this.baseUrl,{params:i}).subscribe(t=>{console.log("\uCE98\uB9B0\uB354 init, ",t),t.calendars.map(e=>{e.startDate=new Date(e.startDate),e.endDate=new Date(e.endDate)}),this.schedules$.next(t.calendars)})}createSchedule(i){let t=i.value;console.log(t);let e=this.createParam(i.value);e.participants=[this.membershipService.user$.getValue().id],console.log("\uC2A4\uCF00\uC904 \uD30C\uB77C\uBBF8\uD130, ",e),this.http.post(this.baseUrl,e).pipe(_(this.destroy$)).subscribe(o=>{console.log("\uC2A4\uCF00\uC904 \uC0DD\uC131 \uC644\uB8CC, ",o);let r=this.schedules$.getValue(),a=I(y({},o),{startDate:new Date(o.startDate),endDate:new Date(o.endDate)});r.push(a);let s=[...r];this.schedules$.next(s),console.log("\uC0DD\uC131 \uD6C4 \uCE98\uB9B0\uB354, ",this.schedules$.getValue())})}updateSchedule(i,t){let e=y({},i);e.scheduleName=t.controls.scheduleName.value,e.scheduleDetail=t.controls.scheduleDetail.value,e.startDate=t.controls.startDate.value,e.endDate=t.controls.endDate.value,e.color=t.controls.color.value,e.status=t.controls.status.value,e.participants=e.participants.map(a=>a?.id),console.log("\uC5C5\uB370\uC774\uD2B8 \uD30C\uB77C\uBBF8\uD130, ",e);let o=this.schedules$.getValue(),r=o.findIndex(a=>a.scheduleId===e.scheduleId);this.http.patch(this.baseUrl,e).pipe(_(this.destroy$)).subscribe(a=>{console.log("\uC5C5\uB370\uC774\uD2B8 \uC644\uB8CC, ",a),a>0&&(e.participants=i.participants,this.calendarUpdateEmitter.emit(e),o[r]=e,this.schedules$.next([...o]))})}updateTaskStatus(i,t){let e=this.schedules$.getValue(),o=e.findIndex(s=>s.scheduleId===i);if(o<0)return;let r=I(y({},e[o]),{status:t}),a=[...e.slice(0,o),r,...e.slice(o+1)];this.schedules$.next(a)}deleteSchedule(i){console.log(`${i} \uC81C\uAC70 \uC2DC\uB3C4`);let t=new b().set("scheduleId",i);this.http.delete(this.baseUrl,{params:t}).pipe(_(this.destroy$)).subscribe(e=>{if(console.log(`${i} \uC81C\uAC70 \uC644\uB8CC `,e),e.affected<1)return;this.calendarDeleteEmitter.emit(i);let o=this.schedules$.getValue().filter(r=>r.scheduleId!=i);this.schedules$.next([...o])})}};var G=class{closeKeyboard(){window.Android?.closeKeyboard&&window.Android.closeKeyboard()}};var tn=(()=>{class n{constructor(t,e,o){this.projectVM=t,this.chatVM=e,this.dmVM=o}static{this.\u0275fac=function(e){return new(e||n)(ot(S),ot(H),ot(Y))}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=P({providers:[{provide:S,useClass:ut},{provide:H,useClass:ht},{provide:Y,useClass:Y},ie,te,{provide:dt,useClass:ft},{provide:pt,useClass:gt},{provide:vt,useClass:vt},{provide:G,useClass:G},Yt,pe,{provide:Ct,useClass:Ct}],imports:[st,me,Q,xe,ve]})}}return n})();export{tn as SyncBiModule};
