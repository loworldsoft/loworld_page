import"./chunk-KGLOOV2F.js";import{a as ct}from"./chunk-XHODO5UR.js";import{A as J,B as X,C as Y,D as Z,E as tt,F as Tt,J as Dt,V as Pt,e as yt,m as I,n as jt,o as bt,r as wt,s as O,v as Et,w as St,x as It,y as Ot,z as Vt}from"./chunk-ARTN3UFO.js";import{a as G}from"./chunk-DE2QPC2X.js";import"./chunk-VUISPKI5.js";import"./chunk-R5FOAF2N.js";import"./chunk-ORS73STK.js";import{D as vt,w as K}from"./chunk-RUVVEFL4.js";import{Aa as gt,Ca as _t,Ea as xt,F as pt,Fa as q,Ia as W,Ka as Mt,Y as lt,Z as dt,ea as E,fa as ut,na as ft,oa as ht,pa as S,qa as z,ra as Ct}from"./chunk-3HC7CDKU.js";import"./chunk-CARY4E7O.js";import{l as st}from"./chunk-TH5CS6OC.js";import{Aa as C,Cb as l,Fa as ot,Fb as B,Ib as j,Ic as rt,Lb as k,Mb as F,Nb as r,Ob as m,Pb as U,Sb as A,Tb as g,Wb as _,Yb as c,a as d,b as u,bc as $,cc as H,cd as at,dc as N,fb as a,ha as T,hc as s,ic as b,id as L,jc as x,kd as w,la as et,ma as f,nb as R,nd as mt,pc as nt,qa as D,qc as Q,ra as P,tc as y,uc as M,xb as v,za as h}from"./chunk-6NI24FLG.js";var $t=[{path:"",component:Tt}],Rt=(()=>{class o{static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275mod=P({type:o})}static{this.\u0275inj=T({imports:[st.forChild($t)]})}}return o})();var qt=["container"],Wt=(o,p)=>p.emoji,Kt=()=>({position:"absolute",zIndex:"100"});function Gt(o,p){if(o&1){let i=g();r(0,"emoji-mart",11),_("emojiSelect",function(t){h(i);let n=c();return C(n.toggleReaction(n.comment.id,t.emoji.native))}),m()}o&2&&(B(Q(4,Kt)),l("emojiTooltip",!0)("useButton",!0))}function Jt(o,p){if(o&1){let i=g();r(0,"button",14),_("click",function(){h(i);let t=c().$implicit,n=c();return C(n.toggleReaction(n.comment.id,t.emoji))}),s(1),y(2,"emojiTransform"),r(3,"span",15),s(4),m()()}if(o&2){let i=c().$implicit;a(),x(" ",M(2,2,i.emoji)," "),a(3),b(i.count)}}function Xt(o,p){if(o&1){let i=g();r(0,"button",16),_("click",function(){h(i);let t=c().$implicit,n=c();return C(n.toggleReaction(n.comment.id,t.emoji))}),s(1),y(2,"emojiTransform"),r(3,"span",15),s(4),m()()}if(o&2){let i=c().$implicit;a(),x(" ",M(2,2,i.emoji)," "),a(3),b(i.count)}}function Yt(o,p){if(o&1&&v(0,Jt,5,4,"button",12)(1,Xt,5,4,"button",13),o&2){let i=p.$implicit,e=c();j(e.isReactedByUser(i.emoji,e.comment.reactions)?0:1)}}var Ut=(()=>{class o{constructor(){this.chatVM=f(G),this.commentVM=f(O),this.membershipService=f(W),this.utilService=f(K),this.loginUser=this.membershipService.getUser(),this.chatCard={display:"flex",margin:0},this.profile={"border-radius":"15%",width:"30px",height:"30px",overflow:"hidden","object-fit":"cover","margin-right":"10px"},this.detail={display:"flex",flexDirection:"column",flex:"1"},this.info={},this.contents={display:"flex",flexDirection:"row",gap:"5px",marginBottom:"10px",width:"80%",height:"80%"},this.isEmojiOpen=!1,this.selectedEmoji=""}ngOnInit(){if(this.container.clear(),!this.comment.commentData||this.comment.commentData.length<1)return;console.log("\uB313\uAE00 \uB370\uC774\uD130 \uC788\uC74C",this.comment.commentData);let i=[],e=[];this.comment.commentData?.forEach(t=>{t.type!=="text"?i.push(t):e.push(t)});for(let t of i){let n=this.container.createComponent(X),V=u(d({},t),{data:u(d({},t),{style:{width:"80%",height:"80%"}}),style:{width:"100%",height:"100%"},dialogData:u(d({},t),{style:{width:"auto",height:"auto",maxWidth:"100vw",maxHeight:"100vh",margin:"auto"}})});n.setInput("data",V)}for(let t of e)this.container.createComponent(J[t.type]).setInput("data",t);i.length===0&&(this.contents=u(d({},this.contents),{marginBottom:"0px"}))}ngAfterViewInit(){}openEmoji(){this.isEmojiOpen=!this.isEmojiOpen}onEmojiSelected(i){this.selectedEmoji=i.emoji.native,console.log("Selected Emoji:",this.selectedEmoji),this.isEmojiOpen=!1}toggleEmoji(){this.isEmojiOpen=!this.isEmojiOpen}groupReactions(i){let e={};return i?.forEach(t=>{e[t.emoji]||(e[t.emoji]={emoji:t.emoji,count:0}),e[t.emoji].count++}),Object.values(e)}isReactedByUser(i,e){let t=this.membershipService.user$.getValue().id;return e?.some(n=>n.emoji===i&&n.user.id===t)}toggleReaction(i,e){console.log("\uD1A0\uAE00, ",e),this.isReactedByUser(e,this.comment.reactions)?this.removeReaction(i,e):this.createReaction(i,e)}createReaction(i,e){console.log("\uC120\uD0DD\uD55C \uC774\uBAA8\uC9C0, ",e),this.isEmojiOpen=!1,this.commentVM.createReaction(i,e)}removeReaction(i,e){this.commentVM.deleteReaction(i,e)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=D({type:o,selectors:[["app-comment-card"]],viewQuery:function(e,t){if(e&1&&$(qt,7,R),e&2){let n;H(n=N())&&(t.container=n.first)}},inputs:{comment:"comment"},decls:17,vars:10,consts:[["container",""],["appHoverEffect","",3,"ngStyle"],[3,"ngStyle"],[3,"data","loginUserId","dmVM"],[1,"files"],[1,"chat-text"],[1,"emoji-container"],["mat-icon-button","","matTooltip","\uBC18\uC751 \uB0A8\uAE30\uAE30",3,"click"],[1,"mat-10"],["set","google",3,"emojiTooltip","style","useButton"],[1,"reactions"],["set","google",3,"emojiSelect","emojiTooltip","useButton"],["mat-flat-button","",1,"reaction-button"],["mat-button","",1,"reaction-button"],["mat-flat-button","",1,"reaction-button",3,"click"],[1,"emoji-count"],["mat-button","",1,"reaction-button",3,"click"]],template:function(e,t){if(e&1){let n=g();r(0,"div",1)(1,"div",2),U(2,"app-chat-header",3),y(3,"async"),r(4,"div",2),A(5,4,0),m(),r(7,"div",5),s(8),m(),r(9,"div",6)(10,"button",7),_("click",function(){return h(n),C(t.toggleEmoji())}),r(11,"mat-icon",8),s(12,"add_reaction"),m()(),v(13,Gt,1,5,"emoji-mart",9),m(),r(14,"div",10),k(15,Yt,2,1,null,null,Wt),m()()()}if(e&2){let n;l("ngStyle",t.chatCard),a(),l("ngStyle",t.detail),a(),l("data",t.comment)("loginUserId",(n=M(3,8,t.loginUser))==null?null:n.id)("dmVM",t.commentVM),a(2),l("ngStyle",t.contents),a(4),x(" ",t.comment.text," "),a(5),j(t.isEmojiOpen?13:-1),a(2),F(t.groupReactions(t.comment.reactions))}},dependencies:[L,S,z,E,q,Y,I,Z,w,tt],styles:['@charset "UTF-8";  .files{display:flex;flex-direction:row;flex-wrap:wrap}.chat-header[_ngcontent-%COMP%]{display:flex}.chat-header-info[_ngcontent-%COMP%]{padding-top:7px;display:flex;align-items:center}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.chat-text[_ngcontent-%COMP%]{margin:0 0 10px;padding:0}.footer-container[_ngcontent-%COMP%]{display:flex}.reactions[_ngcontent-%COMP%]{display:flex;width:100%;flex-wrap:wrap;margin-top:10px;margin-bottom:10px}.reactions[_ngcontent-%COMP%]   button.current-user[_ngcontent-%COMP%], .reactions[_ngcontent-%COMP%]   button.current-user[_ngcontent-%COMP%]:hover{background-color:#007bff!important;color:#fff}.emoji-count[_ngcontent-%COMP%]{font-family:sans-serif}.emoji-container[_ngcontent-%COMP%]{position:relative}.reaction-button[_ngcontent-%COMP%]{padding:5px 2px;width:auto;height:auto}.mat-icon[_ngcontent-%COMP%]{font-size:15px;vertical-align:middle;display:inline-block;line-height:1;width:15px;height:15px}.mat-mdc-icon-button.mat-mdc-button-base[_ngcontent-%COMP%]{padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center}.mat-mdc-icon-button.mat-mdc-button-base[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:auto;height:auto;display:flex;align-items:center;justify-content:center}  .mat-mdc-icon-button .mat-mdc-button-touch-target{width:auto;height:auto}']})}}return o})();var Zt=["container"],te=(o,p)=>p.count,ee=()=>({position:"absolute",zIndex:"100"});function ie(o,p){if(o&1){let i=g();r(0,"emoji-mart",11),_("emojiSelect",function(t){h(i);let n=c();return C(n.toggleReaction(n.chat.chatId,t.emoji.native))}),m()}o&2&&(B(Q(4,ee)),l("emojiTooltip",!0)("useButton",!0))}function oe(o,p){if(o&1){let i=g();r(0,"button",14),_("click",function(){h(i);let t=c().$implicit,n=c();return C(n.toggleReaction(n.chat.chatId,t.emoji))}),s(1),y(2,"emojiTransform"),r(3,"span",15),s(4),m()()}if(o&2){let i=c().$implicit;a(),x(" ",M(2,2,i.emoji)," "),a(3),b(i.count)}}function ne(o,p){if(o&1){let i=g();r(0,"button",16),_("click",function(){h(i);let t=c().$implicit,n=c();return C(n.toggleReaction(n.chat.chatId,t.emoji))}),s(1),y(2,"emojiTransform"),r(3,"span",15),s(4),m()()}if(o&2){let i=c().$implicit;a(),x(" ",M(2,2,i.emoji)," "),a(3),b(i.count)}}function re(o,p){if(o&1&&v(0,oe,5,4,"button",12)(1,ne,5,4,"button",13),o&2){let i=p.$implicit,e=c();j(e.isReactedByUser(i.emoji,e.chat.reactions)?0:1)}}var At=(()=>{class o{constructor(){this.chatVM=f(G),this.commentVM=f(O),this.membershipService=f(W),this.utilService=f(K),this.loginUser=this.membershipService.getUser(),this.showNotification=!1,this.isEmojiOpen=!1,this.chatCard={display:"flex",margin:0},this.profile={"border-radius":"15%",width:"30px",height:"30px",overflow:"hidden","object-fit":"cover","margin-right":"10px"},this.detail={display:"flex",flexDirection:"column",flex:"1"},this.info={},this.contents={display:"flex",flexDirection:"row",gap:"5px",marginBottom:"10px",width:"80%",height:"80%"},this.dataType={text:It,img:Ot,file:Vt},this.selectedEmoji=""}ngOnInit(){if(this.container.clear(),!this.chat.chatData){console.log("\uCC44\uD305 \uB370\uC774\uD130 \uC5C6\uC74C",this.chat);return}console.log("\uCEF4\uD3EC\uB10C\uD2B8 \uC0DD\uC131");let i=[],e=[];this.chat.chatData.forEach(t=>{t.type!=="text"?i.push(t):e.push(t)});for(let t of i){let n=this.container.createComponent(X),V=u(d({},t),{data:u(d({},t),{style:{width:"80%",height:"80%"}}),style:{width:"100%",height:"100%"},dialogData:u(d({},t),{style:{width:"auto",height:"auto",maxWidth:"100vw",maxHeight:"100vh",margin:"auto"}})});n.setInput("data",V)}for(let t of e)this.container.createComponent(J[t.type]).setInput("data",t);i.length===0&&(this.contents=u(d({},this.contents),{marginBottom:"0px"}))}ngAfterViewInit(){}openEmoji(){this.isEmojiOpen=!this.isEmojiOpen}onEmojiSelected(i){this.selectedEmoji=i.emoji.native,console.log("Selected Emoji:",this.selectedEmoji),this.isEmojiOpen=!1}toggleEmoji(){this.isEmojiOpen=!this.isEmojiOpen}groupReactions(i){let e={};return i?.forEach(t=>{e[t.emoji]||(e[t.emoji]={emoji:t.emoji,count:0}),e[t.emoji].count++}),Object.values(e)}isReactedByUser(i,e){let t=this.membershipService.user$.getValue().id;return e?.some(n=>n.emoji===i&&n.user.id===t)}toggleReaction(i,e){console.log("\uD1A0\uAE00, ",e),this.isReactedByUser(e,this.chat.reactions)?this.removeReaction(i,e):this.createReaction(i,e)}createReaction(i,e){console.log("\uC120\uD0DD\uD55C \uC774\uBAA8\uC9C0, ",e),this.isEmojiOpen=!1,this.chatVM.createReaction(i,e)}removeReaction(i,e){this.chatVM.deleteReaction(i,e)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=D({type:o,selectors:[["app-comment-chat"]],viewQuery:function(e,t){if(e&1&&$(Zt,7,R),e&2){let n;H(n=N())&&(t.container=n.first)}},inputs:{chat:"chat"},decls:17,vars:10,consts:[["container",""],["appHoverEffect","",3,"ngStyle"],[3,"ngStyle"],[3,"data","loginUserId","dmVM"],[1,"files"],[1,"chat-text"],[1,"emoji-container"],["mat-icon-button","","matTooltip","\uBC18\uC751 \uB0A8\uAE30\uAE30",3,"click"],[1,"mat-10"],["set","google",3,"emojiTooltip","style","useButton"],[1,"reactions"],["set","google",3,"emojiSelect","emojiTooltip","useButton"],["mat-flat-button","",1,"reaction-button"],["mat-button","",1,"reaction-button"],["mat-flat-button","",1,"reaction-button",3,"click"],[1,"emoji-count"],["mat-button","",1,"reaction-button",3,"click"]],template:function(e,t){if(e&1){let n=g();r(0,"div",1)(1,"div",2),U(2,"app-chat-header",3),y(3,"async"),r(4,"div",2),A(5,4,0),m(),r(7,"div",5),s(8),m(),r(9,"div",6)(10,"button",7),_("click",function(){return h(n),C(t.toggleEmoji())}),r(11,"mat-icon",8),s(12,"add_reaction"),m()(),v(13,ie,1,5,"emoji-mart",9),m(),r(14,"div",10),k(15,re,2,1,null,null,te),m()()()}if(e&2){let n;l("ngStyle",t.chatCard),a(),l("ngStyle",t.detail),a(),l("data",t.chat)("loginUserId",(n=M(3,8,t.loginUser))==null?null:n.id)("dmVM",t.chatVM),a(2),l("ngStyle",t.contents),a(4),x(" ",t.chat.chatText," "),a(5),j(t.isEmojiOpen?13:-1),a(2),F(t.groupReactions(t.chat.reactions))}},dependencies:[L,S,z,E,q,Y,I,Z,w,tt],styles:['@charset "UTF-8";  .files{display:flex;flex-direction:row;flex-wrap:wrap}.chat-header[_ngcontent-%COMP%]{display:flex}.chat-header-info[_ngcontent-%COMP%]{padding-top:7px;display:flex;align-items:center}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.chat-text[_ngcontent-%COMP%]{margin:0 0 10px;padding:0}.hidden[_ngcontent-%COMP%]{visibility:hidden}.reactions[_ngcontent-%COMP%]{display:flex;width:100%;flex-wrap:wrap;margin-top:10px;margin-bottom:10px}.reactions[_ngcontent-%COMP%]   button.current-user[_ngcontent-%COMP%], .reactions[_ngcontent-%COMP%]   button.current-user[_ngcontent-%COMP%]:hover{background-color:#007bff!important;color:#fff}.emoji-count[_ngcontent-%COMP%]{font-family:sans-serif}.emoji-container[_ngcontent-%COMP%]{position:relative}.reaction-button[_ngcontent-%COMP%]{padding:5px 2px;width:auto;height:auto}.mat-icon[_ngcontent-%COMP%]{font-size:15px;vertical-align:middle;display:inline-block;line-height:1;width:15px;height:15px}.mat-mdc-icon-button.mat-mdc-button-base[_ngcontent-%COMP%]{padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center}.mat-mdc-icon-button.mat-mdc-button-base[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:auto;height:auto;display:flex;align-items:center;justify-content:center}  .mat-mdc-icon-button .mat-mdc-button-touch-target{width:auto;height:auto}']})}}return o})();at(ct,"ko");var mo=(()=>{class o{constructor(i,e){this.injector=i,this.commentVM=e}static{this.\u0275fac=function(e){return new(e||o)(et(ot),et(O))}}static{this.\u0275mod=P({type:o})}static{this.\u0275inj=T({providers:[{provide:rt,useValue:"ko"},bt,I],imports:[mt,Rt,Pt,yt,Ct,Mt,ut,gt,lt,dt,xt,_t,pt,vt,Dt,ht,jt]})}}return o})();nt(wt,[S,E,ft,Et,St,Ut,At],[w]);export{mo as ChatModule};
