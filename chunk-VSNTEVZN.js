import{P as mt,Q as ft,W as xt,c as dt,e as ut,f as pt,m as ht}from"./chunk-4DTSJNKC.js";import{$b as rt,Jb as G,Kb as v,Lb as O,Mb as ct,Mc as gt,Qb as j,Ub as z,Vb as V,Z as q,Za as F,Zb as nt,_ as st,_b as it,cb as at,ec as Q,fc as U,g as et,ha as R,ia as k,ic as A,jb as J,kb as lt,pb as ot,rb as N,xa as K}from"./chunk-F2JKNDFL.js";import{a as tt,e as L}from"./chunk-JKOY2XUY.js";var Ct=class T{static \u0275fac=function(e){return new(e||T)};static \u0275mod=lt({type:T});static \u0275inj=st({imports:[ht,xt]})};var bt=class T{constructor(){}extractTextStreamAsJson(t){return L(this,null,function*(){console.log("[EXTRACT_START] ===== extractTextStreamAsJson \uD568\uC218 \uC2DC\uC791 ====="),console.log("[EXTRACT_START] \uD30C\uC77C:",t.name,"\uD06C\uAE30:",t.size);try{console.log("\u{1F4C4} PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC2DC\uC791:",t.name);let e={fileName:t.name,fileSize:t.size,pageCount:0,extractionTimestamp:new Date().toISOString(),extractionMethod:"PDF.js + \uD5A5\uC0C1\uB41C \uBD84\uC11D",pages:[],metadata:{totalTextItems:0,totalWords:0,totalCharacters:0,uniqueFonts:[],hasImages:!1,hasVectorGraphics:!1}},o=yield t.arrayBuffer();if(typeof window.pdfjsLib<"u"){let n=window.pdfjsLib;n.GlobalWorkerOptions.workerSrc||(n.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let i=yield n.getDocument({data:o}).promise;console.log("[PDF_LOADED] PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",i.numPages),e.pageCount=i.numPages,console.log(`\u{1F4CA} \uCD1D \uD398\uC774\uC9C0 \uC218: ${i.numPages}`);let a=new Set,h=0,g=0,f=0;console.log("[PAGE_LOOP] \uD398\uC774\uC9C0 \uCC98\uB9AC \uB8E8\uD504 \uC2DC\uC791");for(let y=1;y<=i.numPages;y++){console.log(`[PAGE_${y}] ===== \uD398\uC774\uC9C0 ${y} \uCC98\uB9AC \uC2DC\uC791 =====`),console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${y} \uCC98\uB9AC \uC911...`);let s=yield i.getPage(y);console.log(`[PAGE_${y}] getPage \uC644\uB8CC`);let m=s.getViewport({scale:1});console.log(`[PAGE_${y}] viewport \uC0DD\uC131 \uC644\uB8CC`);let u=yield s.getTextContent();console.log(`[PAGE_${y}] getTextContent \uC644\uB8CC`),console.log(`[TEXT_EXTRACTION] \uD398\uC774\uC9C0 ${y} \uD14D\uC2A4\uD2B8 \uCD94\uCD9C \uC2DC\uC791`),console.log(`[TEXT_EXTRACTION] textContent.items \uAC1C\uC218: ${u.items.length}`),u.items.length>0&&(console.log("[TEXT_STRUCTURE] textContent.items[0] \uD0A4 \uBAA9\uB85D:",Object.keys(u.items[0])),console.log("[TEXT_STRUCTURE] textContent.items[0] \uC0D8\uD50C \uB370\uC774\uD130:",{str:u.items[0].str,fontName:u.items[0].fontName,transform:u.items[0].transform,hasColor:"color"in u.items[0],allKeys:Object.keys(u.items[0])})),console.log("[COLOR_EXTRACTION] \uC0C9\uC0C1 \uCD94\uCD9C \uD568\uC218 \uD638\uCD9C \uC2DC\uC791");let _=[];try{_=yield this.extractTextColorsFromOperatorList(s),console.log(`[COLOR_EXTRACTION] \uC0C9\uC0C1 \uCD94\uCD9C \uC644\uB8CC: ${_.length}\uAC1C`)}catch(x){console.error("[COLOR_EXTRACTION] \uC0C9\uC0C1 \uCD94\uCD9C \uC911 \uC5D0\uB7EC \uBC1C\uC0DD:",x)}if(console.log(`[SUMMARY] \uD398\uC774\uC9C0 ${y}: textContent.items=${u.items.length}\uAC1C, textColors=${_.length}\uAC1C`),_.length>0){console.log("[COLOR_SAMPLES] \uCD94\uCD9C\uB41C \uC0C9\uC0C1 \uC0D8\uD50C (\uCC98\uC74C 10\uAC1C):",_.slice(0,10));let x=[...new Set(_)];console.log(`[COLOR_STATS] \uACE0\uC720 \uC0C9\uC0C1 \uAC1C\uC218: ${x.length}\uAC1C`,x)}else console.warn(`[COLOR_WARNING] \uD398\uC774\uC9C0 ${y}\uC5D0\uC11C \uC0C9\uC0C1\uC774 \uCD94\uCD9C\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4!`);let S=u.items.map((x,c)=>{let l=x.transform,w={id:`page-${y}-item-${c}`,text:x.str,position:{x:Math.round(l[4]*100)/100,y:Math.round((m.height-l[5])*100)/100,width:Math.round(x.width*100)/100,height:Math.round(x.height*100)/100},font:{name:x.fontName||"Unknown",size:Math.round(Math.abs(l[0])*100)/100},transform:l,style:{direction:x.dir||"ltr",hasEndOfLine:x.hasEOL||!1,color:_[c]||"#000000"},analysis:this.analyzeText(x.str)};return c<5&&console.log(`[TEXT_ITEM_${c}] \uD14D\uC2A4\uD2B8: "${x.str.substring(0,30)}" | \uC0C9\uC0C1: ${_[c]||"\uC5C6\uC74C (#000000 \uC0AC\uC6A9)"} | \uD3F0\uD2B8: ${x.fontName}`),x.fontName&&a.add(x.fontName),w}).filter(x=>x.text.trim().length>0),M=this.groupTextIntoSentences(S),E=this.calculatePageStatistics(S),C={pageNumber:y,width:Math.round(m.width),height:Math.round(m.height),textItems:S,sentences:M,statistics:E};e.pages.push(C),h+=S.length,g+=E.wordCount,f+=E.charCount}let d=yield this.checkForVectorGraphics(i),p;if(d)try{p=yield this.extractVectorGraphicsDetails(i)}catch(y){console.warn("\u26A0\uFE0F \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uC815\uBCF4 \uCD94\uCD9C \uC2E4\uD328:",y)}return e.metadata={totalTextItems:h,totalWords:g,totalCharacters:f,uniqueFonts:Array.from(a),hasImages:yield this.checkForImages(i),hasVectorGraphics:d,vectorGraphicsDetails:p},console.log("\u2705 \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC644\uB8CC"),console.log(`\u{1F4CA} \uD1B5\uACC4: ${h}\uAC1C \uD14D\uC2A4\uD2B8 \uC544\uC774\uD15C, ${g}\uAC1C \uB2E8\uC5B4, ${f}\uAC1C \uBB38\uC790`),e}throw new Error("PDF.js \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}catch(e){throw console.error("\u274C \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC624\uB958:",e),e}})}analyzeText(t){let e=t.trim().split(/\s+/).filter(n=>n.length>0).length,o=t.length;return{wordCount:e,charCount:o,containsEnglish:/[a-zA-Z]/.test(t),containsKorean:/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),containsNumbers:/[0-9]/.test(t),containsSpecialChars:/[!@#$%^&*(),.?":{}|<>]/.test(t)}}groupTextIntoSentences(t){let e=[],o={text:"",items:[],x:null,y:null,width:0,height:0};return t.forEach((n,r)=>{if(o.x===null&&(o.x=n.position.x,o.y=n.position.y),o.text+=n.text,o.items.push(n),o.width+=n.position.width,o.height=Math.max(o.height,n.position.height),(n.style.hasEndOfLine||n.text.includes(".")||n.text.includes("!")||n.text.includes("?")||r===t.length-1)&&o.text.trim()){let a=o.text.trim();e.push({id:`sentence-${e.length+1}`,text:a,position:{x:o.x||0,y:o.y||0,width:o.width,height:o.height},itemCount:o.items.length,itemIds:o.items.map(h=>h.id),language:this.detectLanguage(a)}),o={text:"",items:[],x:null,y:null,width:0,height:0}}}),e}detectLanguage(t){let e=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),o=/[a-zA-Z]/.test(t);return e&&o?"mixed":e?"korean":o?"english":"unknown"}calculatePageStatistics(t){let e=t.reduce((i,a)=>i+a.analysis.wordCount,0),o=t.reduce((i,a)=>i+a.analysis.charCount,0),n=t.length>0?t.reduce((i,a)=>i+a.font.size,0)/t.length:0,r={};return t.forEach(i=>{r[i.font.name]=(r[i.font.name]||0)+1}),{totalItems:t.length,wordCount:e,charCount:o,avgFontSize:Math.round(n*100)/100,fontDistribution:r}}checkForImages(t){return L(this,null,function*(){try{for(let e=1;e<=t.numPages;e++){let n=yield(yield t.getPage(e)).getOperatorList({intent:"display"});for(let r=0;r<n.fnArray.length;r++){let i=n.fnArray[r];if(i===window.pdfjsLib.OPS.paintImageXObject||i===window.pdfjsLib.OPS.paintInlineImageXObject)return!0}}}catch(e){console.warn("\uC774\uBBF8\uC9C0 \uD655\uC778 \uC911 \uC624\uB958:",e)}return!1})}checkForVectorGraphics(t){return L(this,null,function*(){try{for(let e=1;e<=t.numPages;e++){let n=yield(yield t.getPage(e)).getOperatorList({intent:"display"});for(let r=0;r<n.fnArray.length;r++){let i=n.fnArray[r];if(i===window.pdfjsLib.OPS.moveTo||i===window.pdfjsLib.OPS.lineTo||i===window.pdfjsLib.OPS.curveTo||i===window.pdfjsLib.OPS.rectangle||i===window.pdfjsLib.OPS.fill||i===window.pdfjsLib.OPS.stroke)return!0}}}catch(e){console.warn("\uBCA1\uD130 \uADF8\uB798\uD53D \uD655\uC778 \uC911 \uC624\uB958:",e)}return!1})}extractVectorGraphicsDetails(t){return L(this,null,function*(){console.log("\u{1F3A8} \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uC815\uBCF4 \uCD94\uCD9C \uC2DC\uC791...");let e={totalOperations:0,summary:{totalPaths:0,totalLines:0,totalCurves:0,totalRectangles:0,totalFillOperations:0,totalStrokeOperations:0,totalClipOperations:0},pageDetails:[]};try{for(let o=1;o<=t.numPages;o++){let n=yield t.getPage(o),r=yield n.getOperatorList({intent:"display"}),i={pageNumber:o,operations:[],statistics:{pathCount:0,lineCount:0,curveCount:0,rectangleCount:0,fillCount:0,strokeCount:0,clipCount:0}};for(let h=0;h<r.fnArray.length;h++){let g=r.fnArray[h],f=r.argsArray[h],d=null,p=!1;g===1?(d="moveTo",p=!0,i.statistics.pathCount++,e.summary.totalPaths++):g===2?(d="lineTo",p=!0,i.statistics.lineCount++,e.summary.totalLines++):g>=3&&g<=6?(d="curve",p=!0,i.statistics.curveCount++,e.summary.totalCurves++):g===7?(d="rectangle",p=!0,i.statistics.rectangleCount++,e.summary.totalRectangles++):g===9?(d="closePath",p=!0):g===22?(d="fill",p=!0,i.statistics.fillCount++,e.summary.totalFillOperations++):g===20?(d="stroke",p=!0,i.statistics.strokeCount++,e.summary.totalStrokeOperations++):g===29?(d="clip",p=!0,i.statistics.clipCount++,e.summary.totalClipOperations++):g>=31&&g<=34?(d="matrixTransform",p=!1):g>=10&&g<=12?(d="styleSettings",p=!1):[28,37,42,44,58,59,70,71,91].includes(g)&&(f&&Array.isArray(f)&&f.length>=2&&typeof f[f.length-2]=="number"&&typeof f[f.length-1]=="number"?(d="unknownVectorGraphic",p=!0):(d="unknownOperation",p=!1)),d&&(p||d.includes("Transform")||d.includes("Settings"))&&(i.operations.push({type:d,args:f||[],opCode:g,isVectorGraphic:p,coordinates:this.extractCoordinates(f)}),p&&e.totalOperations++)}i.operations.length>0&&(e.pageDetails.push(i),console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${o} OperatorList: ${i.operations.length}\uAC1C \uC5F0\uC0B0`)),console.log(`\u{1F3A8} \uD398\uC774\uC9C0 ${o} SVG \uB80C\uB354\uB9C1 \uC911...`);let a=yield this.extractVectorGraphicsFromSVG(n,window.pdfjsLib);console.log(`\u2705 \uD398\uC774\uC9C0 ${o} SVG \uBD84\uC11D:`,{paths:a.totalPaths,lines:a.totalLines,curves:a.totalCurves,fills:a.totalFills}),e.summary.totalPaths+=a.totalPaths,e.summary.totalLines+=a.totalLines,e.summary.totalCurves+=a.totalCurves}return console.log("\u2705 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uBD84\uC11D \uC644\uB8CC:",{totalOperations:e.totalOperations,totalPaths:e.summary.totalPaths,totalPages:e.pageDetails.length}),e}catch(o){throw console.error("\u274C \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C1\uC138 \uC815\uBCF4 \uCD94\uCD9C \uC624\uB958:",o),o}})}extractTextColorsFromOperatorList(t){return L(this,null,function*(){console.log("[OPERATOR_LIST] extractTextColorsFromOperatorList \uD568\uC218 \uC2DC\uC791");try{console.log("[OPERATOR_LIST] getOperatorList \uD638\uCD9C \uC911...");let e=yield t.getOperatorList({intent:"display"});console.log("[OPERATOR_LIST] getOperatorList \uC644\uB8CC");let o=e.fnArray,n=e.argsArray;console.log(`[OPERATOR_LIST] fnArray \uAE38\uC774: ${o.length}, argsArray \uAE38\uC774: ${n.length}`);let r=window.pdfjsLib;if(!r||!r.OPS)return console.error("[OPERATOR_LIST] pdfjsLib.OPS\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4!"),[];let i=r.OPS;console.log("[OPERATOR_LIST] OPS \uAC1D\uCCB4 \uD0A4 \uC0D8\uD50C:",Object.keys(i).slice(0,20)),console.log("[OPERATOR_LIST] \uC0C9\uC0C1 \uAD00\uB828 OPS \uAC12:",{setFillRGBColor:i.setFillRGBColor,setFillGray:i.setFillGray,setFillCMYKColor:i.setFillCMYKColor,setFillColor:i.setFillColor,showText:i.showText,showSpacedText:i.showSpacedText});let a=[],h="#000000",g="DeviceRGB";console.log(`[COLOR_TRACKING] \uC0C9\uC0C1 \uCD94\uCD9C \uC2DC\uC791 - \uCD1D ${o.length}\uAC1C \uC5F0\uC0B0 \uBD84\uC11D`);let f=0,d=0;for(let p=0;p<o.length;p++){let y=o[p],s=n[p];if(y===i.setFillColorSpace)g=s[0]?.name||s[0]||"DeviceRGB",console.log(`[COLOR_SPACE] \uC0C9\uC0C1 \uACF5\uAC04 \uBCC0\uACBD (\uC5F0\uC0B0 ${p}): ${g}`);else if(y===i.setFillRGBColor){f++;try{if(!Array.isArray(s)||s.length<3){console.error(`[RGB_ERROR] setFillRGBColor \uC778\uC790 \uC624\uB958 (\uC5F0\uC0B0 ${p}): args\uB294 \uCD5C\uC18C 3\uAC1C \uC694\uC18C\uB97C \uAC00\uC9C4 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568`,s);continue}let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),_=typeof s[2]=="number"?s[2]:parseFloat(s[2]);if(isNaN(m)||isNaN(u)||isNaN(_)){console.error(`[RGB_ERROR] setFillRGBColor \uAC12 \uBCC0\uD658 \uC2E4\uD328 (\uC5F0\uC0B0 ${p}):`,{rawR:m,rawG:u,rawB:_,args:s});continue}let S=Math.max(0,Math.min(255,Math.round(m*255))),M=Math.max(0,Math.min(255,Math.round(u*255))),E=Math.max(0,Math.min(255,Math.round(_*255)));h=`#${S.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")}`,f<=5&&console.log(`[RGB_${f}] \uC5F0\uC0B0 ${p}: [${m.toFixed(3)}, ${u.toFixed(3)}, ${_.toFixed(3)}] \u2192 [${S}, ${M}, ${E}] \u2192 ${h}`)}catch(m){console.error(`[RGB_ERROR] setFillRGBColor \uCC98\uB9AC \uC911 \uC624\uB958 (\uC5F0\uC0B0 ${p}):`,m,s)}}else if(y===i.setFillGray)try{if(!Array.isArray(s)||s.length<1){console.error("\u274C setFillGray \uC778\uC790 \uC624\uB958: args\uB294 \uCD5C\uC18C 1\uAC1C \uC694\uC18C\uB97C \uAC00\uC9C4 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568",s);continue}let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]);if(isNaN(m)){console.error("\u274C setFillGray \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{rawGray:m,args:s});continue}console.log(`\u{1F3A8} setFillGray RAW value: ${m}`);let u=Math.max(0,Math.min(255,Math.round(m*255)));h=`#${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} Gray \uC0C9\uC0C1 \uC124\uC815: ${m} \u2192 ${u} \u2192 ${h}`)}catch(m){console.error("\u274C setFillGray \uCC98\uB9AC \uC911 \uC624\uB958:",m,s)}else if(y===i.setFillCMYKColor)try{if(!Array.isArray(s)||s.length<4){console.error("\u274C setFillCMYKColor \uC778\uC790 \uC624\uB958: args\uB294 \uCD5C\uC18C 4\uAC1C \uC694\uC18C\uB97C \uAC00\uC9C4 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568",s);continue}let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),_=typeof s[2]=="number"?s[2]:parseFloat(s[2]),S=typeof s[3]=="number"?s[3]:parseFloat(s[3]);if(isNaN(m)||isNaN(u)||isNaN(_)||isNaN(S)){console.error("\u274C setFillCMYKColor \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{c:m,m:u,y:_,k:S,args:s});continue}console.log(`\u{1F3A8} setFillCMYKColor RAW values: C=${m}, M=${u}, Y=${_}, K=${S}`);let M=Math.max(0,Math.min(255,Math.round(255*(1-m)*(1-S)))),E=Math.max(0,Math.min(255,Math.round(255*(1-u)*(1-S)))),C=Math.max(0,Math.min(255,Math.round(255*(1-_)*(1-S))));h=`#${M.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")}${C.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} CMYK \uC0C9\uC0C1 \uC124\uC815: [${m}, ${u}, ${_}, ${S}] \u2192 [${M}, ${E}, ${C}] \u2192 ${h}`)}catch(m){console.error("\u274C setFillCMYKColor \uCC98\uB9AC \uC911 \uC624\uB958:",m,s)}else if(y===i.setFillColor)try{if(console.log(`\u{1F3A8} setFillColor \uD638\uCD9C: colorSpace=${g}, args=`,s,`(length: ${s?.length}, types: ${Array.isArray(s)?s.map(m=>typeof m).join(", "):"not array"})`),!Array.isArray(s)){console.error("\u274C setFillColor \uC778\uC790 \uC624\uB958: args\uB294 \uBC30\uC5F4\uC774\uC5B4\uC57C \uD568",s);continue}if(g==="DeviceRGB"&&s.length>=3){let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),_=typeof s[2]=="number"?s[2]:parseFloat(s[2]);if(isNaN(m)||isNaN(u)||isNaN(_)){console.error("\u274C setFillColor RGB \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{rawR:m,rawG:u,rawB:_,args:s});continue}let S=Math.max(0,Math.min(255,Math.round(m*255))),M=Math.max(0,Math.min(255,Math.round(u*255))),E=Math.max(0,Math.min(255,Math.round(_*255)));h=`#${S.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} setFillColor RGB: [${m}, ${u}, ${_}] \u2192 [${S}, ${M}, ${E}] \u2192 ${h}`)}else if(g==="DeviceGray"&&s.length>=1){let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]);if(isNaN(m)){console.error("\u274C setFillColor Gray \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{rawGray:m,args:s});continue}let u=Math.max(0,Math.min(255,Math.round(m*255)));h=`#${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} setFillColor Gray: ${m} \u2192 ${u} \u2192 ${h}`)}else if(g==="DeviceCMYK"&&s.length>=4){let m=typeof s[0]=="number"?s[0]:parseFloat(s[0]),u=typeof s[1]=="number"?s[1]:parseFloat(s[1]),_=typeof s[2]=="number"?s[2]:parseFloat(s[2]),S=typeof s[3]=="number"?s[3]:parseFloat(s[3]);if(isNaN(m)||isNaN(u)||isNaN(_)||isNaN(S)){console.error("\u274C setFillColor CMYK \uAC12 \uBCC0\uD658 \uC2E4\uD328:",{c:m,m:u,y:_,k:S,args:s});continue}let M=Math.max(0,Math.min(255,Math.round(255*(1-m)*(1-S)))),E=Math.max(0,Math.min(255,Math.round(255*(1-u)*(1-S)))),C=Math.max(0,Math.min(255,Math.round(255*(1-_)*(1-S))));h=`#${M.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")}${C.toString(16).padStart(2,"0")}`,console.log(`\u{1F3A8} setFillColor CMYK: [${m}, ${u}, ${_}, ${S}] \u2192 [${M}, ${E}, ${C}] \u2192 ${h}`)}else console.warn(`\u26A0\uFE0F \uC54C \uC218 \uC5C6\uB294 \uC0C9\uC0C1 \uACF5\uAC04 \uB610\uB294 \uC778\uC790: colorSpace=${g}, args=`,s)}catch(m){console.error("\u274C setFillColor \uCC98\uB9AC \uC911 \uC624\uB958:",m,s)}else if((y===i.showText||y===i.showSpacedText||y===i.nextLineShowText)&&(d++,a.push(h),d<=5)){let m=y===i.showText?"showText":y===i.showSpacedText?"showSpacedText":"nextLineShowText";console.log(`[TEXT_${d}] \uC5F0\uC0B0 ${p} (${m}): \uC0C9\uC0C1=${h}, \uD14D\uC2A4\uD2B8 \uC218\uC9D1 \uC644\uB8CC`)}}if(console.log("[COLOR_TRACKING] \uC0C9\uC0C1 \uCD94\uCD9C \uC644\uB8CC"),console.log(`[COLOR_STATS] \uCD1D \uC0C9\uC0C1 \uBCC0\uACBD: ${f}\uD68C, \uD14D\uC2A4\uD2B8 \uC5F0\uC0B0: ${d}\uAC1C, \uC218\uC9D1\uB41C \uC0C9\uC0C1: ${a.length}\uAC1C`),a.length>0){let p=[...new Set(a)];console.log(`[COLOR_STATS] \uACE0\uC720 \uC0C9\uC0C1: ${p.length}\uAC1C`,p)}return a}catch(e){return console.error("[COLOR_EXTRACTION_ERROR] \uD14D\uC2A4\uD2B8 \uC0C9\uC0C1 \uCD94\uCD9C \uC2E4\uD328:",e),[]}})}extractColorsFromSVG(t){let e=[],o=[],n={};try{let r=t.querySelectorAll("*");console.log(`[SVG_COLOR] SVG \uC694\uC18C \uAC1C\uC218: ${r.length}`),r.forEach((h,g)=>{let f=h.getAttribute("fill");if(f&&f!=="none"&&f!=="transparent"){let p=this.normalizeSVGColor(f);e.push(p),n[p]=(n[p]||0)+1,g<5&&console.log(`[SVG_COLOR] \uC694\uC18C ${g} fill: ${f} \u2192 ${p}`)}let d=h.getAttribute("stroke");if(d&&d!=="none"&&d!=="transparent"){let p=this.normalizeSVGColor(d);o.push(p),g<5&&console.log(`[SVG_COLOR] \uC694\uC18C ${g} stroke: ${d} \u2192 ${p}`)}});let i=[...new Set(e)],a=[...new Set(o)];return console.log(`[SVG_COLOR] Fill \uC0C9\uC0C1: ${e.length}\uAC1C (\uACE0\uC720: ${i.length}\uAC1C)`),console.log(`[SVG_COLOR] Stroke \uC0C9\uC0C1: ${o.length}\uAC1C (\uACE0\uC720: ${a.length}\uAC1C)`),console.log("[SVG_COLOR] \uACE0\uC720 Fill \uC0C9\uC0C1:",i),console.log("[SVG_COLOR] \uACE0\uC720 Stroke \uC0C9\uC0C1:",a),{fillColors:e,strokeColors:o,uniqueFillColors:i,uniqueStrokeColors:a,colorDistribution:n}}catch(r){return console.error("[SVG_COLOR_ERROR] SVG \uC0C9\uC0C1 \uCD94\uCD9C \uC2E4\uD328:",r),{fillColors:[],strokeColors:[],uniqueFillColors:[],uniqueStrokeColors:[],colorDistribution:{}}}}normalizeSVGColor(t){try{if(/^#[0-9a-fA-F]{6}$/.test(t))return t.toLowerCase();if(/^#[0-9a-fA-F]{3}$/.test(t))return`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`.toLowerCase();let e=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(e){let n=parseInt(e[1]).toString(16).padStart(2,"0"),r=parseInt(e[2]).toString(16).padStart(2,"0"),i=parseInt(e[3]).toString(16).padStart(2,"0");return`#${n}${r}${i}`}let o=t.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(o){let n=parseInt(o[1]).toString(16).padStart(2,"0"),r=parseInt(o[2]).toString(16).padStart(2,"0"),i=parseInt(o[3]).toString(16).padStart(2,"0");return`#${n}${r}${i}`}return console.warn(`[SVG_COLOR] \uC54C \uC218 \uC5C6\uB294 \uC0C9\uC0C1 \uD615\uC2DD: ${t}`),"#000000"}catch(e){return console.error(`[SVG_COLOR] \uC0C9\uC0C1 \uBCC0\uD658 \uC624\uB958: ${t}`,e),"#000000"}}extractTextColorsFromSVG(t){let e=[],o=[];try{let n=t.querySelectorAll("text, tspan");console.log(`[SVG_TEXT_COLOR] \uD14D\uC2A4\uD2B8 \uC694\uC18C \uAC1C\uC218: ${n.length}`),n.forEach((i,a)=>{let h=i.textContent?.trim()||"",g=i.getAttribute("fill");if(!g||g==="none"){let s=i.parentElement;for(;s&&(!g||g==="none");)g=s.getAttribute("fill"),s=s.parentElement}let f=g&&g!=="none"?this.normalizeSVGColor(g):"#000000",d=parseFloat(i.getAttribute("x")||"0"),p=parseFloat(i.getAttribute("y")||"0"),y=i.getAttribute("transform");if(y){let s=y.match(/translate\(([^,]+),\s*([^)]+)\)/);s&&(d+=parseFloat(s[1]),p+=parseFloat(s[2]))}o.push({x:d,y:p,color:f}),h&&e.push({text:h,color:f,x:d,y:p}),a<10&&console.log(`[SVG_TEXT_COLOR] \uC694\uC18C ${a}: (${d.toFixed(2)}, ${p.toFixed(2)}) \u2192 ${f} ${h?`"${h.substring(0,20)}"`:"(\uD14D\uC2A4\uD2B8 \uC5C6\uC74C)"}`)});let r=[...new Set(o.map(i=>i.color))];return console.log(`[SVG_TEXT_COLOR] \uCD1D ${o.length}\uAC1C \uC704\uCE58, \uACE0\uC720 \uC0C9\uC0C1 ${r.length}\uAC1C`,r),{textItems:e,colorsByPosition:o}}catch(n){return console.error("[SVG_TEXT_COLOR_ERROR] SVG \uD14D\uC2A4\uD2B8 \uC0C9\uC0C1 \uCD94\uCD9C \uC2E4\uD328:",n),{textItems:[],colorsByPosition:[]}}}downloadJsonData(t){try{let e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json;charset=utf-8;"}),n=document.createElement("a"),r=URL.createObjectURL(o),i=new Date().toISOString().split("T")[0],a=`${t.fileName}_text_stream_${i}.json`;n.setAttribute("href",r),n.setAttribute("download",a),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),console.log(`\u2705 JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC: ${a}`)}catch(e){throw console.error("\u274C JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC624\uB958:",e),e}}logJsonData(t){console.group("\u{1F4C4} PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC JSON \uB370\uC774\uD130"),console.log("\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",{fileName:t.fileName,fileSize:t.fileSize,pageCount:t.pageCount,extractionTimestamp:t.extractionTimestamp}),console.log("\u{1F4C8} \uD1B5\uACC4:",t.metadata),console.log("\uFFFD \uC5B8\uC5B4 \uD1B5\uACC4:",t.metadata.languageDetection),console.log("\uFFFD\u{1F4DD} \uD398\uC774\uC9C0\uBCC4 \uC694\uC57D:",t.pages.map(e=>({page:e.pageNumber,textItems:e.statistics.totalItems,words:e.statistics.wordCount,englishCount:e.statistics.englishTextCount||0,koreanCount:e.statistics.koreanTextCount||0}))),console.log("\u{1F4C4} \uC804\uCCB4 JSON \uB370\uC774\uD130:",t),console.groupEnd()}processFileWithAutoExtraction(t){return L(this,null,function*(){try{console.log("\u{1F680} PDF \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791 (\uC790\uB3D9 \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C):",t.name);let e=yield this.extractTextStreamAsJson(t);this.logJsonData(e);let o=this.generateSummary(e);return console.log(`\u{1F4CB} \uC694\uC57D \uC815\uBCF4:
`+o),e}catch(e){throw console.error("\u274C PDF \uD30C\uC77C \uCC98\uB9AC \uC2E4\uD328:",e),e}})}filterTextByCondition(t,e){let o=[];return t.pages.forEach(n=>{e.pageNumber&&n.pageNumber!==e.pageNumber||n.textItems.forEach(r=>{let i=!0;e.containsEnglish!==void 0&&(i=i&&r.analysis.containsEnglish===e.containsEnglish),e.containsKorean!==void 0&&(i=i&&r.analysis.containsKorean===e.containsKorean),e.minFontSize!==void 0&&(i=i&&r.font.size>=e.minFontSize),e.maxFontSize!==void 0&&(i=i&&r.font.size<=e.maxFontSize),i&&o.push(r)})}),o}generateSummary(t){return[`\u{1F4C4} PDF \uD30C\uC77C: ${t.fileName}`,"\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",`   - \uD30C\uC77C \uD06C\uAE30: ${this.formatFileSize(t.fileSize)}`,`   - \uD398\uC774\uC9C0 \uC218: ${t.pageCount}`,`   - \uCD94\uCD9C \uC2DC\uAC04: ${new Date(t.extractionTimestamp).toLocaleString("ko-KR")}`,"","\u{1F4C8} \uD14D\uC2A4\uD2B8 \uD1B5\uACC4:",`   - \uCD1D \uD14D\uC2A4\uD2B8 \uC544\uC774\uD15C: ${t.metadata.totalTextItems.toLocaleString()}\uAC1C`,`   - \uCD1D \uB2E8\uC5B4 \uC218: ${t.metadata.totalWords.toLocaleString()}\uAC1C`,`   - \uCD1D \uBB38\uC790 \uC218: ${t.metadata.totalCharacters.toLocaleString()}\uAC1C`,`   - \uC0AC\uC6A9\uB41C \uD3F0\uD2B8: ${t.metadata.uniqueFonts.length}\uAC1C`,"","\u{1F5BC}\uFE0F \uBBF8\uB514\uC5B4 \uC694\uC18C:",`   - \uC774\uBBF8\uC9C0 \uD3EC\uD568: ${t.metadata.hasImages?"\uC608":"\uC544\uB2C8\uC624"}`,`   - \uBCA1\uD130 \uADF8\uB798\uD53D \uD3EC\uD568: ${t.metadata.hasVectorGraphics?"\uC608":"\uC544\uB2C8\uC624"}`,"","\u{1F4DD} \uD398\uC774\uC9C0\uBCC4 \uC0C1\uC138:",...t.pages.map(o=>`   \uD398\uC774\uC9C0 ${o.pageNumber}: ${o.statistics.totalItems}\uAC1C \uD14D\uC2A4\uD2B8, ${o.statistics.wordCount}\uB2E8\uC5B4`)].join(`
`)}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+o[n]}extractVectorStreamData(t){return L(this,null,function*(){console.log("\u{1F3A8} \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB370\uC774\uD130 \uCD94\uCD9C \uC2DC\uC791...");let e=yield t.arrayBuffer(),o=yield window.pdfjsLib.getDocument(e).promise,n={fileName:t.name.replace(/\.[^/.]+$/,""),fileSize:t.size,pageCount:o.numPages,extractionTimestamp:new Date().toISOString(),extractionMethod:"PDF.js OperatorList Analysis",totalOperations:0,summary:{totalPaths:0,totalLines:0,totalCurves:0,totalRectangles:0,totalFillOperations:0,totalStrokeOperations:0,totalClipOperations:0},pageDetails:[],debugInfo:{totalOperatorsFound:0,recognizedOperators:0,unrecognizedOperators:0,uniqueOperatorCodes:[]}},r=new Set;try{for(let i=1;i<=o.numPages;i++){let a=yield o.getPage(i),h=yield a.getOperatorList({intent:"display"});n.debugInfo.totalOperatorsFound+=h.fnArray.length,h.fnArray.forEach(x=>r.add(x));let g={pageNumber:i,operations:[],statistics:{pathCount:0,lineCount:0,curveCount:0,rectangleCount:0,fillCount:0,strokeCount:0,clipCount:0}},f=[],d=!1,p=null,y=[],s="#000000",m="#000000",u=[],_=[],S=[],E=window.pdfjsLib.OPS;console.log(`[COLOR_VECTOR] \uD398\uC774\uC9C0 ${i} \uBCA1\uD130 \uC0C9\uC0C1 \uCD94\uC801 \uC2DC\uC791`);for(let x=0;x<h.fnArray.length;x++){let c=h.fnArray[x],l=h.argsArray[x],b="",w=!1;if(c===E.setFillRGBColor){if(l&&l.length>=3){let P=Math.round(l[0]*255),$=Math.round(l[1]*255),D=Math.round(l[2]*255);s=`#${P.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Fill RGB \uC124\uC815: ${s}`)}}else if(c===E.setStrokeRGBColor){if(l&&l.length>=3){let P=Math.round(l[0]*255),$=Math.round(l[1]*255),D=Math.round(l[2]*255);m=`#${P.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Stroke RGB \uC124\uC815: ${m}`)}}else if(c===E.setFillGray){if(l&&l.length>=1){let P=Math.round(l[0]*255);s=`#${P.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Fill Gray \uC124\uC815: ${s}`)}}else if(c===E.setStrokeGray){if(l&&l.length>=1){let P=Math.round(l[0]*255);m=`#${P.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}`,console.log(`[COLOR_VECTOR] Stroke Gray \uC124\uC815: ${m}`)}}else if(c===30)p&&y.push([...p]),u.push(s),_.push(m);else if(c===31)l&&l.length>=6&&(p=l.slice(0,6)),b="matrixTransform";else if(c===32)y.length>0&&(p=y.pop()||null),u.length>0&&(s=u.pop()),_.length>0&&(m=_.pop());else if(c===1)l&&l.length>=2&&(f.push({type:"moveTo",coords:[l[0],l[1]]}),d=!0),b="moveTo",w=!0,g.statistics.pathCount++,n.summary.totalPaths++;else if(c===2)l&&l.length>=2&&(f.push({type:"lineTo",coords:[l[0],l[1]]}),d=!0),b="lineTo",w=!0,g.statistics.lineCount++,n.summary.totalLines++;else if(c>=3&&c<=6)l&&l.length>=6&&(f.push({type:"curve",coords:l.slice(0,6)}),d=!0),b="curve",w=!0,g.statistics.curveCount++,n.summary.totalCurves++;else if(c===7)l&&l.length>=4&&(f.push({type:"rectangle",coords:[l[0],l[1],l[2],l[3]]}),d=!0),b="rectangle",w=!0,g.statistics.rectangleCount++,n.summary.totalRectangles++;else if(c===9)d&&f.push({type:"closePath",coords:[]}),b="closePath",w=!0;else if(c===22){if(b="fill",w=!0,g.statistics.fillCount++,n.summary.totalFillOperations++,S.push({operation:"fill",fillColor:s,strokeColor:m}),!d&&p){let P=p[4],$=p[5],D=p[0],B=p[3],I=Math.max(Math.abs(D),Math.abs(B),1);f.push({type:"implicitRect",coords:[P,$,I,I]}),d=!0,console.log(`\u{1F538} \uC554\uBB35\uC801 fill path \uC0DD\uC131: (${P.toFixed(2)}, ${$.toFixed(2)}) ${I.toFixed(2)}x${I.toFixed(2)} \uC0C9\uC0C1: ${s}`)}}else c===20?(b="stroke",w=!0,g.statistics.strokeCount++,n.summary.totalStrokeOperations++,S.push({operation:"stroke",fillColor:s,strokeColor:m})):c===29?(b="clip",w=!0,g.statistics.clipCount++,n.summary.totalClipOperations++):c===12?(l&&l.length===6&&(p=l.slice(0,6)),b="styleSettings"):c>=10&&c<=11?b="styleSettings":[28,37,42,44,58,59,70,71,91].includes(c)&&(l&&Array.isArray(l)&&l.length>=2&&typeof l[l.length-2]=="number"&&typeof l[l.length-1]=="number"?(b="unknownVectorGraphic",w=!0):(b="unknownOperation",w=!1));if(b&&(w||b.includes("Transform")||b.includes("Settings"))){let P={type:b,args:l||[],opCode:c,opName:this.getOpName(c)||`code_${c}`,isVectorGraphic:w,coordinates:this.extractCoordinates(l)};(b==="fill"||b==="stroke")&&f.length>0&&(P.currentPath=[...f],P.pathSegments=f.length),p&&(P.transformMatrix=[...p]),g.operations.push(P),w&&(n.totalOperations++,n.debugInfo.recognizedOperators++),(b==="fill"||b==="stroke")&&(f=[],d=!1)}else n.debugInfo.unrecognizedOperators++}if(console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${i} OperatorList: ${g.operations.length}\uAC1C \uC5F0\uC0B0`),S.length>0){let x=[...new Set(S.map(l=>l.fillColor))],c=[...new Set(S.map(l=>l.strokeColor))];console.log(`[COLOR_VECTOR] \uD398\uC774\uC9C0 ${i} \uC0C9\uC0C1 \uD1B5\uACC4:`),console.log(`  - Fill \uC5F0\uC0B0: ${S.filter(l=>l.operation==="fill").length}\uAC1C`),console.log(`  - Stroke \uC5F0\uC0B0: ${S.filter(l=>l.operation==="stroke").length}\uAC1C`),console.log(`  - \uACE0\uC720 Fill \uC0C9\uC0C1: ${x.length}\uAC1C`,x),console.log(`  - \uACE0\uC720 Stroke \uC0C9\uC0C1: ${c.length}\uAC1C`,c),g.colorInfo={colorsByOperation:S,uniqueFillColors:x,uniqueStrokeColors:c,totalFillOperations:S.filter(l=>l.operation==="fill").length,totalStrokeOperations:S.filter(l=>l.operation==="stroke").length}}console.log(`\u{1F3A8}\u{1F3A8}\u{1F3A8} [SVG_GENERATION] \uD398\uC774\uC9C0 ${i} SVG \uC0DD\uC131 \uC2DC\uC791 \u{1F3A8}\u{1F3A8}\u{1F3A8}`);try{console.log("[SVG_GENERATION] viewport \uC0DD\uC131 \uC911...");let x=a.getViewport({scale:1});console.log("[SVG_GENERATION] OperatorList \uCD94\uCD9C \uC911...");let c=yield a.getOperatorList({intent:"display"});console.log("[SVG_GENERATION] SVGGraphics \uAC1D\uCCB4 \uC0DD\uC131 \uC911...");let l=new window.pdfjsLib.SVGGraphics(a.commonObjs,a.objs);console.log("[SVG_GENERATION] getSVG \uD638\uCD9C \uC911...");let b=yield l.getSVG(c,x);console.log("[SVG_GENERATION] SVG \uC0DD\uC131 \uC644\uB8CC! \uD0C0\uC785:",b?.constructor?.name),console.log("\u{1F3A8}\u{1F3A8}\u{1F3A8} [SVG_COLOR] SVG \uC694\uC18C\uC5D0\uC11C \uC0C9\uC0C1 \uCD94\uCD9C \uC2DC\uC791 \u{1F3A8}\u{1F3A8}\u{1F3A8}");let w=this.extractColorsFromSVG(b);console.log("\u{1F3A8}\u{1F3A8}\u{1F3A8} [SVG_COLOR] \uCD94\uCD9C \uC644\uB8CC! \uC0C9\uC0C1 \uC815\uBCF4: \u{1F3A8}\u{1F3A8}\u{1F3A8}",w),console.log("[OPERATOR_COLOR_POSITION] OperatorList\uC5D0\uC11C \uD14D\uC2A4\uD2B8 \uC0C9\uC0C1-\uC704\uCE58 \uCD94\uCD9C \uC2DC\uC791");let P=yield this.extractTextColorsAndPositionsFromOperatorList(a),$=P.colorPositions,D=P.debugInfo;console.log(`[OPERATOR_COLOR_POSITION] \uCD94\uCD9C \uC644\uB8CC: ${$.length}\uAC1C`);let B={textItemsCount:$.length,uniqueTextColors:[...new Set($.map(H=>H.color))],colorsByPosition:$,debugInfo:D,sampleTextItems:$.slice(0,10).map(H=>({text:"",color:H.color,position:{x:H.x,y:H.y}}))};console.log("[OPERATOR_COLOR_POSITION] textColorInfo \uC0DD\uC131 \uC644\uB8CC:",B),g.svgColorInfo=w,g.textColorInfo=B,console.log("[SVG_COLOR] pageDetail\uC5D0 svgColorInfo \uBC0F textColorInfo \uC800\uC7A5 \uC644\uB8CC");let I=b.querySelectorAll("text, tspan");I.forEach(H=>H.remove()),console.log(`\u{1F5D1}\uFE0F ${I.length}\uAC1C\uC758 \uD14D\uC2A4\uD2B8 \uC694\uC18C \uC81C\uAC70\uB428`);let X=new XMLSerializer().serializeToString(b);X=X.replace(/<svg:svg/g,"<svg").replace(/<\/svg:svg>/g,"</svg>").replace(/<svg:g/g,"<g").replace(/<\/svg:g>/g,"</g>").replace(/<svg:path/g,"<path").replace(/<\/svg:path>/g,"</path>").replace(/<svg:rect/g,"<rect").replace(/<\/svg:rect>/g,"</rect>").replace(/<svg:line/g,"<line").replace(/<\/svg:line>/g,"</line>").replace(/<svg:circle/g,"<circle").replace(/<\/svg:circle>/g,"</circle>").replace(/<svg:ellipse/g,"<ellipse").replace(/<\/svg:ellipse>/g,"</ellipse>").replace(/<svg:polygon/g,"<polygon").replace(/<\/svg:polygon>/g,"</polygon>").replace(/<svg:polyline/g,"<polyline").replace(/<\/svg:polyline>/g,"</polyline>").replace(/<svg:text/g,"<text").replace(/<\/svg:text>/g,"</text>").replace(/<svg:tspan/g,"<tspan").replace(/<\/svg:tspan>/g,"</tspan>").replace(/xmlns:svg="[^"]*"/g,"").replace(/xmlns:xlink="[^"]*"/g,'xmlns:xlink="http://www.w3.org/1999/xlink"').replace(/<svg /g,'<svg xmlns="http://www.w3.org/2000/svg" '),g.svgContent=X,console.log(`\u2705\u2705\u2705 \uD398\uC774\uC9C0 ${i} SVG \uC0DD\uC131 \uC644\uB8CC (\uAE38\uC774: ${g.svgContent.length}\uC790) \u2705\u2705\u2705`),console.log("\u{1F50D} SVG \uC2DC\uC791 \uBD80\uBD84:",g.svgContent.substring(0,200))}catch(x){console.error(`\u274C\u274C\u274C [SVG_ERROR] \uD398\uC774\uC9C0 ${i} SVG \uC0DD\uC131 \uC2E4\uD328! \u274C\u274C\u274C`,x),console.error("[SVG_ERROR] \uC5D0\uB7EC \uC0C1\uC138:",{message:x.message,stack:x.stack,name:x.name}),g.svgContent=void 0}(g.operations.length>0||g.svgContent)&&(n.pageDetails.push(g),console.log(`\u{1F4E6} \uD398\uC774\uC9C0 ${i} pageDetails\uC5D0 \uCD94\uAC00\uB428 (SVG: ${g.svgContent?"YES":"NO"})`)),console.log(`\u{1F3A8} \uD398\uC774\uC9C0 ${i} SVG \uBD84\uC11D \uC911...`);let C=yield this.extractVectorGraphicsFromSVG(a,window.pdfjsLib);console.log(`\u2705 \uD398\uC774\uC9C0 ${i} SVG \uBD84\uC11D \uC644\uB8CC:`,{paths:C.totalPaths,lines:C.totalLines,curves:C.totalCurves,fills:C.totalFills}),n.summary.totalPaths+=C.totalPaths,n.summary.totalLines+=C.totalLines,n.summary.totalCurves+=C.totalCurves,console.log(`\u{1F4CA} \uD398\uC774\uC9C0 ${i} \uB204\uC801 \uD1B5\uACC4:`,{totalPaths:n.summary.totalPaths,totalLines:n.summary.totalLines,totalCurves:n.summary.totalCurves,totalFills:n.summary.totalFillOperations})}return n.debugInfo.uniqueOperatorCodes=Array.from(r).sort(),n.extractionMethod="PDF.js OperatorList + SVG Rendering (Hybrid)",console.log("\u2705 \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB370\uC774\uD130 \uCD94\uCD9C \uC644\uB8CC:",{totalOperations:n.totalOperations,recognizedOperators:n.debugInfo.recognizedOperators,unrecognizedOperators:n.debugInfo.unrecognizedOperators}),n}catch(i){throw console.error("\u274C \uBCA1\uD130 \uC2A4\uD2B8\uB9BC \uB370\uC774\uD130 \uCD94\uCD9C \uC624\uB958:",i),i}})}downloadVectorStreamJson(t){try{let e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json;charset=utf-8;"}),n=document.createElement("a"),r=URL.createObjectURL(o),i=new Date().toISOString().split("T")[0],a=`${t.fileName}_vector_stream_${i}.json`;n.setAttribute("href",r),n.setAttribute("download",a),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),console.log(`\u2705 \uBCA1\uD130 \uC2A4\uD2B8\uB9BC JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC: ${a}`)}catch(e){throw console.error("\u274C \uBCA1\uD130 \uC2A4\uD2B8\uB9BC JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC624\uB958:",e),e}}logVectorStreamJson(t){console.group("\u{1F3A8} PDF \uBCA1\uD130 \uC2A4\uD2B8\uB9BC JSON \uB370\uC774\uD130"),console.log("\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",{fileName:t.fileName,fileSize:t.fileSize,pageCount:t.pageCount,extractionTimestamp:t.extractionTimestamp}),console.log("\u{1F4C8} \uBCA1\uD130 \uD1B5\uACC4:",t.summary),console.log("\u{1F50D} \uB514\uBC84\uADF8 \uC815\uBCF4:",t.debugInfo),console.log("\u{1F3A8} \uC804\uCCB4 \uBCA1\uD130 JSON \uB370\uC774\uD130:",t),console.groupEnd()}getOpName(t){return{1:"moveTo",2:"lineTo",3:"curveTo",4:"quadraticCurveTo",5:"bezierCurveTo",6:"arcTo",7:"rectangle",9:"closePath",10:"setLineWidth",11:"setLineCap",12:"setLineJoin",20:"stroke",22:"fill",29:"clip",31:"concat",32:"scale",33:"rotate",34:"translate"}[t]||null}extractCoordinates(t){if(!t||!Array.isArray(t))return null;if(t.length===6&&t.every(o=>typeof o=="number"))return{type:"matrix",x:t[4],y:t[5],transform:[t[0],t[1],t[2],t[3]]};if(t.length===2&&t.every(o=>typeof o=="number"))return{type:"point",x:t[0],y:t[1]};if(t.length===4&&t.every(o=>typeof o=="number"))return{type:"rectangle",x:t[0],y:t[1],width:t[2],height:t[3]};let e=t.filter(o=>typeof o=="number");return e.length>=2?{type:"extracted",x:e[e.length-2],y:e[e.length-1],allNumbers:e}:null}parseSVGPathCommands(t){let e={moveToCount:0,lineToCount:0,curveToCount:0,commands:[]};if(!t||typeof t!="string")return e;let o=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g,n;for(;(n=o.exec(t))!==null;){let r=n[1],i=n[2].trim();if(!i){(r==="Z"||r==="z")&&e.commands.push({type:"closePath",coords:[]});continue}let a=i.replace(/,/g," ").replace(/-/g," -").split(/\s+/).filter(h=>h&&h!=="-").map(h=>parseFloat(h)).filter(h=>!isNaN(h));switch(r.toUpperCase()){case"M":e.moveToCount++,e.commands.push({type:"moveTo",coords:a});break;case"L":e.lineToCount++,e.commands.push({type:"lineTo",coords:a});break;case"H":e.lineToCount++,e.commands.push({type:"hLineTo",coords:a});break;case"V":e.lineToCount++,e.commands.push({type:"vLineTo",coords:a});break;case"C":e.curveToCount++,e.commands.push({type:"curveTo",coords:a});break;case"S":e.curveToCount++,e.commands.push({type:"smoothCurveTo",coords:a});break;case"Q":e.curveToCount++,e.commands.push({type:"quadraticCurveTo",coords:a});break;case"T":e.curveToCount++,e.commands.push({type:"smoothQuadraticCurveTo",coords:a});break;case"A":e.curveToCount++,e.commands.push({type:"arc",coords:a});break;case"Z":e.commands.push({type:"closePath",coords:[]});break}}return e}analyzeSVGPaths(t){let e={totalPaths:0,totalLines:0,totalCurves:0,totalFills:0,pathDetails:[],renderablePaths:[]};return t.querySelectorAll("path").forEach((n,r)=>{let i=n.getAttribute("d");if(!i)return;let a=this.parseSVGPathCommands(i);e.totalPaths+=a.moveToCount,e.totalLines+=a.lineToCount,e.totalCurves+=a.curveToCount;let h=n.getAttribute("fill"),g=n.getAttribute("stroke"),f=h&&h.toLowerCase()!=="none",d=g&&g.toLowerCase()!=="none";(f||d)&&(f&&e.totalFills++,e.renderablePaths.push({element:n,d:i,fill:h,stroke:g,strokeWidth:n.getAttribute("stroke-width"),opacity:n.getAttribute("opacity"),transform:n.getAttribute("transform")})),e.pathDetails.push({pathIndex:r,moveToCount:a.moveToCount,lineToCount:a.lineToCount,curveToCount:a.curveToCount,dAttribute:i.substring(0,100)+(i.length>100?"...":"")})}),e}extractVectorGraphicsFromSVG(t,e){return L(this,null,function*(){try{let o=t.getViewport({scale:1}),n=yield t.getOperatorList({intent:"display"}),i=yield new e.SVGGraphics(t.commonObjs,t.objs).getSVG(n,o),a=this.analyzeSVGPaths(i),g=new XMLSerializer().serializeToString(i);return{totalPaths:a.totalPaths,totalLines:a.totalLines,totalCurves:a.totalCurves,totalFills:a.totalFills,svgString:g.substring(0,500),renderablePaths:a.renderablePaths}}catch(o){return console.error("\u274C SVG \uB80C\uB354\uB9C1 \uC911 \uC624\uB958:",o),{totalPaths:0,totalLines:0,totalCurves:0,totalFills:0,svgString:"",renderablePaths:[]}}})}redrawVectorGraphicsFromSVG(t,e,o){return L(this,null,function*(){try{console.log("\u{1F3A8} SVG \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2DC\uC791...");let n=o.querySelector("canvas");if(!n)return console.error("\u274C \uCE94\uBC84\uC2A4\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),{success:!1,totalElementsCreated:0,fillCount:0,strokeCount:0};let r=n.width,i=n.height,a=n.offsetWidth,h=n.offsetHeight;console.log(`\u{1F4D0} \uCE94\uBC84\uC2A4 \uD06C\uAE30: ${r} x ${i}`),console.log(`\u{1F4D0} \uD45C\uC2DC \uD06C\uAE30: ${a} x ${h}`);let g=t.getViewport({scale:1}),f=r/g.width;console.log(`\u{1F4CF} PDF \uC6D0\uBCF8 \uD06C\uAE30: ${g.width} x ${g.height}`),console.log(`\u{1F50D} \uD604\uC7AC \uC2A4\uCF00\uC77C: ${f}`);let d=t.getViewport({scale:f}),p=yield t.getOperatorList({intent:"display"}),s=yield new e.SVGGraphics(t.commonObjs,t.objs).getSVG(p,d);console.log("\u{1F50D} \uC0DD\uC131\uB41C SVG \uC804\uCCB4 \uAD6C\uC870:"),console.log("SVG \uD06C\uAE30:",d.width,"x",d.height),console.log("SVG \uC790\uC2DD \uC694\uC18C \uAC1C\uC218:",s.children.length),Array.from(s.children).forEach((M,E)=>{let C=M;if(console.log(`
\u{1F4E6} \uC694\uC18C ${E+1}:`,C.tagName),C.tagName==="path"){let x=C;console.log("  - d:",x.getAttribute("d")?.substring(0,100)+"..."),console.log("  - fill:",x.getAttribute("fill")),console.log("  - stroke:",x.getAttribute("stroke")),console.log("  - transform:",x.getAttribute("transform"))}else C.tagName==="g"&&(console.log("  - transform:",C.getAttribute("transform")),console.log("  - \uC790\uC2DD \uAC1C\uC218:",C.children.length),Array.from(C.children).forEach((x,c)=>{let l=x;if(l.tagName==="path"){let b=l;console.log(`    \u2022 path ${c+1}:`),console.log("      - d:",b.getAttribute("d")?.substring(0,80)+"..."),console.log("      - fill:",b.getAttribute("fill")),console.log("      - stroke:",b.getAttribute("stroke"))}}))});let m=this.analyzeSVGPaths(s);if(m.renderablePaths.length===0)return console.warn("\u26A0\uFE0F \uB80C\uB354\uB9C1 \uAC00\uB2A5\uD55C \uBCA1\uD130 \uC694\uC18C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."),{success:!1,totalElementsCreated:0,fillCount:0,strokeCount:0};console.log(`
\u{1F4CA} \uB80C\uB354\uB9C1 \uAC00\uB2A5\uD55C \uBCA1\uD130 \uC694\uC18C: ${m.renderablePaths.length}\uAC1C`),console.log(`   - fill \uC694\uC18C: ${m.totalFills}\uAC1C`);let u=o.querySelector(".vector-graphics-overlay");u?(u.innerHTML="",u.style.width=`${a}px`,u.style.height=`${h}px`,u.setAttribute("viewBox",`0 0 ${d.width} ${d.height}`)):(u=document.createElementNS("http://www.w3.org/2000/svg","svg"),u.classList.add("vector-graphics-overlay"),u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width=`${a}px`,u.style.height=`${h}px`,u.style.pointerEvents="none",u.style.zIndex="10",u.setAttribute("viewBox",`0 0 ${d.width} ${d.height}`),u.setAttribute("preserveAspectRatio","xMidYMid meet"),o.style.position="relative",o.appendChild(u));let _=0,S=0;return m.renderablePaths.forEach((M,E)=>{try{let C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("d",M.d),M.fill&&(C.setAttribute("fill",M.fill),_++),M.stroke&&(C.setAttribute("stroke",M.stroke),S++),M.strokeWidth&&C.setAttribute("stroke-width",M.strokeWidth),M.opacity&&C.setAttribute("opacity",M.opacity),M.transform&&C.setAttribute("transform",M.transform),C.classList.add("vector-path"),C.setAttribute("data-path-index",E.toString()),u.appendChild(C)}catch(C){console.error(`\u274C Path ${E} \uC0DD\uC131 \uC2E4\uD328:`,C)}}),console.log(`\u2705 \uBCA1\uD130 \uC694\uC18C \uC0DD\uC131 \uC644\uB8CC: ${m.renderablePaths.length}\uAC1C`),console.log(`   - fill: ${_}\uAC1C, stroke: ${S}\uAC1C`),{success:!0,totalElementsCreated:m.renderablePaths.length,fillCount:_,strokeCount:S}}catch(n){return console.error("\u274C \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2E4\uD328:",n),{success:!1,totalElementsCreated:0,fillCount:0,strokeCount:0}}})}redrawAllPagesVectorGraphics(t,e,o){return L(this,null,function*(){try{console.log("\u{1F3A8}\u{1F3A8}\u{1F3A8} \uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2DC\uC791...");let n=t.numPages,r=0,i=0,a=0;for(let h=1;h<=n;h++){let g=yield t.getPage(h),f=o.querySelector(`.page[data-page-number="${h}"]`);if(!f){console.warn(`\u26A0\uFE0F \uD398\uC774\uC9C0 ${h} DOM \uC694\uC18C\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.`);continue}let d=yield this.redrawVectorGraphicsFromSVG(g,e,f);d.success&&(r+=d.totalElementsCreated,i+=d.fillCount,a+=d.strokeCount)}console.log("\u2705\u2705\u2705 \uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC644\uB8CC!"),console.log(`\u{1F4CA} \uCD1D \uC0DD\uC131\uB41C \uC694\uC18C: ${r}\uAC1C`),console.log(`   - fill: ${i}\uAC1C`),console.log(`   - stroke: ${a}\uAC1C`)}catch(n){throw console.error("\u274C \uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D \uC0C8\uB85C\uADF8\uB9AC\uAE30 \uC2E4\uD328:",n),n}})}viewVectorGraphicsAsSVG(t,e,o){return L(this,null,function*(){try{console.log(`\u{1F5BC}\uFE0F \uD398\uC774\uC9C0 ${o} \uBCA1\uD130 \uADF8\uB798\uD53D SVG \uC0DD\uC131 \uC911...`);let n=t.getViewport({scale:2}),r=n.width,i=n.height,a=yield t.getOperatorList({intent:"display"}),g=yield new e.SVGGraphics(t.commonObjs,t.objs).getSVG(a,n),d=new XMLSerializer().serializeToString(g);d.includes("viewBox")||(d=d.replace("<svg",`<svg viewBox="0 0 ${r} ${i}"`));let p=`
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\uD398\uC774\uC9C0 ${o} - \uBCA1\uD130 \uADF8\uB798\uD53D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }
        .info {
            color: #666;
            font-size: 14px;
        }
        .info-item {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 5px;
        }
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: auto;
        }
        svg {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
        }
        .controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>\u{1F4CA} PDF \uBCA1\uD130 \uADF8\uB798\uD53D - \uD398\uC774\uC9C0 ${o}</h1>
        <div class="info">
            <span class="info-item">\u{1F4D0} \uD06C\uAE30: ${r.toFixed(2)} \xD7 ${i.toFixed(2)}</span>
            <span class="info-item">\u{1F50D} \uC2A4\uCF00\uC77C: 2.0x</span>
            <span class="info-item">\u{1F4C5} \uC0DD\uC131: ${new Date().toLocaleString("ko-KR")}</span>
        </div>
    </div>

    <div class="controls">
        <button onclick="downloadSVG()">\u{1F4BE} SVG \uB2E4\uC6B4\uB85C\uB4DC</button>
        <button onclick="copyToClipboard()" class="secondary">\u{1F4CB} SVG \uCF54\uB4DC \uBCF5\uC0AC</button>
        <button onclick="toggleGrid()" class="secondary">\u{1F4CF} \uADF8\uB9AC\uB4DC \uD1A0\uAE00</button>
    </div>

    <div class="svg-container" id="svgContainer">
        ${d}
    </div>

    <script>
        function downloadSVG() {
            const svgElement = document.querySelector('svg');
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgElement);
            const blob = new Blob([svgString], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'page_${o}_vector_graphics.svg';
            a.click();
            URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
            const svgElement = document.querySelector('svg');
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgElement);
            navigator.clipboard.writeText(svgString).then(() => {
                console.log('\u2705 SVG \uCF54\uB4DC\uAC00 \uD074\uB9BD\uBCF4\uB4DC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!');
            }).catch(err => {
                console.error('\uBCF5\uC0AC \uC2E4\uD328:', err);
            });
        }

        let gridVisible = false;
        function toggleGrid() {
            const container = document.getElementById('svgContainer');
            if (gridVisible) {
                container.style.backgroundImage = 'none';
                gridVisible = false;
            } else {
                container.style.backgroundImage = 
                    'linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),' +
                    'linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px)';
                container.style.backgroundSize = '20px 20px';
                gridVisible = true;
            }
        }
    <\/script>
</body>
</html>
      `,y=window.open("","_blank");y?(y.document.write(p),y.document.close(),console.log("\u2705 SVG \uBCA1\uD130 \uADF8\uB798\uD53D\uC774 \uC0C8 \uCC3D\uC5D0 \uD45C\uC2DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!")):console.error("\u274C \uD31D\uC5C5\uC774 \uCC28\uB2E8\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uD31D\uC5C5 \uD5C8\uC6A9 \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.")}catch(n){throw console.error("\u274C SVG \uC0DD\uC131 \uC2E4\uD328:",n),n}})}downloadAllPagesVectorGraphicsAsSVG(t,e){return L(this,null,function*(){try{console.log("\u{1F4E6} \uBAA8\uB4E0 \uD398\uC774\uC9C0\uC758 \uBCA1\uD130 \uADF8\uB798\uD53D SVG \uC0DD\uC131 \uC911...");let o=t.numPages,n="";for(let g=1;g<=o;g++){let f=yield t.getPage(g),d=f.getViewport({scale:2}),p=yield f.getOperatorList({intent:"display"}),s=yield new e.SVGGraphics(f.commonObjs,f.objs).getSVG(p,d),u=new XMLSerializer().serializeToString(s);n+=`
<!-- \uD398\uC774\uC9C0 ${g} -->
${u}
`}let r=`
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>\uC804\uCCB4 \uD398\uC774\uC9C0 \uBCA1\uD130 \uADF8\uB798\uD53D</title>
    <style>
        body { margin: 20px; background: #f5f5f5; }
        .page { background: white; margin-bottom: 40px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { margin: 0 0 20px 0; color: #333; }
        svg { max-width: 100%; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>\u{1F4DA} PDF \uBCA1\uD130 \uADF8\uB798\uD53D (\uC804\uCCB4 ${o}\uD398\uC774\uC9C0)</h1>
    ${n}
</body>
</html>
      `,i=new Blob([r],{type:"text/html"}),a=URL.createObjectURL(i),h=document.createElement("a");h.href=a,h.download=`all_pages_vector_graphics_${Date.now()}.html`,h.click(),URL.revokeObjectURL(a),console.log("\u2705 \uBAA8\uB4E0 \uD398\uC774\uC9C0\uC758 \uBCA1\uD130 \uADF8\uB798\uD53D\uC774 \uB2E4\uC6B4\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!")}catch(o){throw console.error("\u274C \uC804\uCCB4 \uD398\uC774\uC9C0 SVG \uB2E4\uC6B4\uB85C\uB4DC \uC2E4\uD328:",o),o}})}extractTextColorsAndPositionsFromOperatorList(t){return L(this,null,function*(){try{let e=yield t.getOperatorList({intent:"display"}),o=t.getViewport({scale:1}),n=e.fnArray,r=e.argsArray,i=window.pdfjsLib;if(!i||!i.OPS)return console.error("[OPERATOR_LIST] pdfjsLib.OPS\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4!"),{colorPositions:[],debugInfo:{totalOperations:0,colorChangeCount:0,textOperationCount:0,opsCodeCheck:{},colorChanges:[],textOperations:[]}};let a=i.OPS,h=[],g=[],f=[],d="#000000",p=[1,0,0,1,0,0],y="DeviceRGB",s=0,m=0,u=!1,_="#000000",S=[],M={setFillRGBColor:a.setFillRGBColor,setFillGray:a.setFillGray,setFillColorSpace:a.setFillColorSpace,showText:a.showText,showSpacedText:a.showSpacedText,beginText:a.beginText,endText:a.endText};console.log(`[COLOR_POSITION] \uC0C9\uC0C1-\uC704\uCE58 \uCD94\uCD9C \uC2DC\uC791 - \uCD1D ${n.length}\uAC1C \uC5F0\uC0B0 \uBD84\uC11D`),console.log("[COLOR_POSITION] OPS \uCF54\uB4DC \uD655\uC778:",M);for(let C=0;C<n.length;C++){let x=n[C],c=r[C];if(x===a.beginText){u=!0;continue}else if(x===a.endText){u=!1;continue}if(x===a.transform){let[l,b,w,P,$,D]=c,[B,I,Y,X,H,Tt]=p;p=[l*B+b*Y,l*I+b*X,w*B+P*Y,w*I+P*X,$*B+D*Y+H,$*I+D*X+Tt]}else x===a.setTextMatrix&&(p=c.slice());if(x===a.setFillColorSpace){let l=c[0]?.name||c[0]||"DeviceRGB";l!==y&&(console.log(`[COLOR_SPACE_CHANGE] ${y} \u2192 ${l} (\uC5F0\uC0B0 ${C})`),y=l)}else if(x===a.setFillRGBColor){if(s++,s<=10&&S.push({changeNumber:s,operationIndex:C,type:"setFillRGBColor",argsIsArray:Array.isArray(c),argsLength:c?.length,argsValue:c,argsType:typeof c,isInTextObject:u}),c&&c.length>=3){let l=c[0]<=1&&c[1]<=1&&c[2]<=1,b=l?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0]))),w=l?Math.max(0,Math.min(255,Math.round(c[1]*255))):Math.max(0,Math.min(255,Math.round(c[1]))),P=l?Math.max(0,Math.min(255,Math.round(c[2]*255))):Math.max(0,Math.min(255,Math.round(c[2]))),$=`#${b.toString(16).padStart(2,"0")}${w.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}`;d=$,u&&(_=$,g.push({index:C,type:"setFillRGBColor",color:$,args:[c[0],c[1],c[2]]})),s<=10&&console.log(`[COLOR_RGB_${s}] \uC5F0\uC0B0 ${C}: [${c[0]}, ${c[1]}, ${c[2]}] \u2192 ${$} (normalized=${l}, inText=${u})`)}}else if(x===a.setFillGray){if(s++,s<=10&&S.push({changeNumber:s,operationIndex:C,type:"setFillGray",argsIsArray:Array.isArray(c),argsLength:c?.length,argsValue:c,argsType:typeof c,isInTextObject:u}),c&&c.length>=1){let l=c[0]<=1,b=l?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0]))),w=`#${b.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}`;d=w,u&&(_=w,g.push({index:C,type:"setFillGray",color:w,args:[c[0]]})),s<=10&&console.log(`[COLOR_GRAY_${s}] \uC5F0\uC0B0 ${C}: ${c[0]} \u2192 ${w} (normalized=${l}, inText=${u})`)}}else if(x===a.setFillCMYKColor){if(c&&c.length>=4){let[l,b,w,P]=c,$=Math.max(0,Math.min(255,Math.round(255*(1-l)*(1-P)))),D=Math.max(0,Math.min(255,Math.round(255*(1-b)*(1-P)))),B=Math.max(0,Math.min(255,Math.round(255*(1-w)*(1-P)))),I=`#${$.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}${B.toString(16).padStart(2,"0")}`;d=I,u&&(_=I)}}else if(x===a.setFillColor){if(c){let l=d;if(y==="DeviceRGB"&&c.length>=3){let b=c[0]<=1&&c[1]<=1&&c[2]<=1,w=b?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0]))),P=b?Math.max(0,Math.min(255,Math.round(c[1]*255))):Math.max(0,Math.min(255,Math.round(c[1]))),$=b?Math.max(0,Math.min(255,Math.round(c[2]*255))):Math.max(0,Math.min(255,Math.round(c[2])));l=`#${w.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}`}else if(y==="DeviceGray"&&c.length>=1){let w=c[0]<=1?Math.max(0,Math.min(255,Math.round(c[0]*255))):Math.max(0,Math.min(255,Math.round(c[0])));l=`#${w.toString(16).padStart(2,"0")}${w.toString(16).padStart(2,"0")}${w.toString(16).padStart(2,"0")}`}d=l,u&&(_=l)}}else if(x===a.showText||x===a.showSpacedText||x===a.nextLineShowText){m++;let l=p[4],b=o.height-p[5],w=x===a.showText?"showText":x===a.showSpacedText?"showSpacedText":"nextLineShowText";h.push({x:l,y:b,color:_}),f.push({index:C,type:w,x:l,y:b,color:_}),m<=10&&console.log(`[COLOR_POSITION_${m}] \uC5F0\uC0B0 ${C} (${w}): (${l.toFixed(2)}, ${b.toFixed(2)}) \u2192 ${_} (inText=${u})`)}}console.log(`[COLOR_POSITION] \uCD94\uCD9C \uC644\uB8CC: ${h.length}\uAC1C \uD14D\uC2A4\uD2B8-\uC0C9\uC0C1-\uC704\uCE58 \uC30D`),console.log(`[COLOR_POSITION] \uC0C9\uC0C1 \uBCC0\uACBD: ${s}\uD68C, \uD14D\uC2A4\uD2B8 \uC5F0\uC0B0: ${m}\uAC1C`);let E=[...new Set(h.map(C=>C.color))];return console.log(`[COLOR_POSITION] \uACE0\uC720 \uC0C9\uC0C1: ${E.length}\uAC1C`,E),{colorPositions:h,debugInfo:{totalOperations:n.length,colorChangeCount:s,textOperationCount:m,opsCodeCheck:M,colorChanges:g.slice(0,20),textOperations:f.slice(0,20),argsCheckLog:S}}}catch(e){return console.error("[COLOR_POSITION_ERROR] \uC0C9\uC0C1-\uC704\uCE58 \uCD94\uCD9C \uC2E4\uD328:",e),{colorPositions:[],debugInfo:{totalOperations:0,colorChangeCount:0,textOperationCount:0,opsCodeCheck:{},colorChanges:[],textOperations:[]}}}})}static \u0275fac=function(e){return new(e||T)};static \u0275prov=q({token:T,factory:T.\u0275fac,providedIn:"root"})};var yt=class T{constructor(){}deletePages(t,e){return L(this,null,function*(){try{let n=yield(yield fetch(t)).arrayBuffer(),r=yield PDFLib.PDFDocument.load(n),i=r.getPageCount();console.log(`\uC6D0\uBCF8 PDF \uD398\uC774\uC9C0 \uC218: ${i}`),console.log(`\uC0AD\uC81C\uD560 \uD398\uC774\uC9C0: ${e.join(", ")}`);let a=[...e].sort((d,p)=>p-d);for(let d of a)if(d<1||d>i)throw new Error(`\uD398\uC774\uC9C0 ${d}\uB294 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. (\uCD1D ${i}\uD398\uC774\uC9C0)`);for(let d of a){let p=d-1;r.removePage(p),console.log(`\uD398\uC774\uC9C0 ${d} \uC0AD\uC81C \uC644\uB8CC`)}let h=yield r.save(),g=new Blob([h],{type:"application/pdf"}),f=URL.createObjectURL(g);return console.log(`\uD398\uC774\uC9C0 \uC0AD\uC81C \uC644\uB8CC. \uB0A8\uC740 \uD398\uC774\uC9C0 \uC218: ${r.getPageCount()}`),f}catch(o){throw console.error("PDF \uD398\uC774\uC9C0 \uC0AD\uC81C \uC911 \uC624\uB958 \uBC1C\uC0DD:",o),o}})}getPageCount(t){return L(this,null,function*(){try{let o=yield(yield fetch(t)).arrayBuffer();return(yield PDFLib.PDFDocument.load(o)).getPageCount()}catch(e){throw console.error("PDF \uD398\uC774\uC9C0 \uC218 \uD655\uC778 \uC911 \uC624\uB958 \uBC1C\uC0DD:",e),e}})}static \u0275fac=function(e){return new(e||T)};static \u0275prov=q({token:T,factory:T.\u0275fac,providedIn:"root"})};var _t=class T{textEditorsSubject=new et([]);activeEditorIdSubject=new et(null);textEditors$=this.textEditorsSubject.asObservable();activeEditorId$=this.activeEditorIdSubject.asObservable();idCounter=0;constructor(){}createTextEditor(t=100,e=100){let o=`text-editor-${++this.idCounter}`,n={id:o,x:t,y:e,width:200,height:100,rotation:0,text:""},r=this.textEditorsSubject.value;return this.textEditorsSubject.next([...r,n]),this.setActiveEditor(o),o}addTextEditor(t){let e=this.textEditorsSubject.value;this.textEditorsSubject.next([...e,t])}updateTextEditor(t,e){let n=this.textEditorsSubject.value.map(r=>r.id===t?tt(tt({},r),e):r);this.textEditorsSubject.next(n)}deleteTextEditor(t){let o=this.textEditorsSubject.value.filter(n=>n.id!==t);this.textEditorsSubject.next(o),this.activeEditorIdSubject.value===t&&this.setActiveEditor(null)}setActiveEditor(t){this.activeEditorIdSubject.next(t)}getActiveEditor(){return this.activeEditorIdSubject.value}getTextEditor(t){return this.textEditorsSubject.value.find(e=>e.id===t)}getAllTextEditors(){return this.textEditorsSubject.value}getAllActiveEditors(){return this.textEditorsSubject.value}clearAllTextEditors(){this.textEditorsSubject.next([]),this.setActiveEditor(null)}exportTextEditors(){return JSON.stringify(this.textEditorsSubject.value,null,2)}importTextEditors(t){try{let e=JSON.parse(t);return Array.isArray(e)?(this.textEditorsSubject.next(e),this.setActiveEditor(null),!0):!1}catch(e){return console.error("Failed to import text editors:",e),!1}}static \u0275fac=function(e){return new(e||T)};static \u0275prov=q({token:T,factory:T.\u0275fac,providedIn:"root"})};var Z=class T{constructor(t){this.cdr=t}textEditor;position={x:0,y:0};cssClass="";fontSizeChange=new N;fontFamilyChange=new N;boldToggle=new N;italicToggle=new N;underlineToggle=new N;textAlignChange=new N;colorChange=new N;ngOnInit(){console.log("PdfTextEditorToolbarComponent ngOnInit")}ngOnChanges(t){console.log("PdfTextEditorToolbarComponent ngOnChanges:",t),t.textEditor&&(console.log("textEditor changed:",t.textEditor.currentValue),this.cdr.detectChanges()),t.position&&console.log("position changed:",t.position.currentValue)}onFontSizeChange(t){let e=t.target,o=parseInt(e.value,10);this.fontSizeChange.emit({editor:this.textEditor,fontSize:o})}onFontFamilyChange(t){let o=t.target.value;this.fontFamilyChange.emit({editor:this.textEditor,fontFamily:o})}onBoldToggle(){this.boldToggle.emit(this.textEditor)}onItalicToggle(){this.italicToggle.emit(this.textEditor)}onUnderlineToggle(){this.underlineToggle.emit(this.textEditor)}onTextAlignChange(t){this.textAlignChange.emit({editor:this.textEditor,align:t})}onColorChange(t){let o=t.target.value;this.colorChange.emit({editor:this.textEditor,color:o})}static \u0275fac=function(e){return new(e||T)(at(gt))};static \u0275cmp=J({type:T,selectors:[["app-pdf-text-adder-toolbar"]],inputs:{textEditor:"textEditor",position:"position",cssClass:"cssClass"},outputs:{fontSizeChange:"fontSizeChange",fontFamilyChange:"fontFamilyChange",boldToggle:"boldToggle",italicToggle:"italicToggle",underlineToggle:"underlineToggle",textAlignChange:"textAlignChange",colorChange:"colorChange"},standalone:!1,features:[K],decls:50,vars:20,consts:[[1,"text-style-toolbar",3,"ngClass"],[1,"toolbar-group"],["type","number","min","8","max","72","step","1",3,"change","value"],[3,"change","value"],["value","Arial"],["value","Helvetica"],["value","Times New Roman"],["value","Courier New"],["value","Georgia"],["value","Verdana"],["value","NanumGothicLocal"],["value","'Pretendard Variable', 'Pretendard'"],["value","'Noto Sans KR'"],["value","'Pretendard Variable', 'Pretendard', 'Noto Sans KR', 'NanumGothicLocal', 'NanumGothic', '\uB098\uB214\uACE0\uB515', sans-serif"],["title","\uAD75\uAC8C",3,"click"],["title","\uAE30\uC6B8\uC784",3,"click"],["title","\uBC11\uC904",3,"click"],["title","\uC67C\uCABD \uC815\uB82C",3,"click"],["title","\uAC00\uC6B4\uB370 \uC815\uB82C",3,"click"],["title","\uC624\uB978\uCABD \uC815\uB82C",3,"click"],["type","color",3,"change","value"]],template:function(e,o){e&1&&(v(0,"div",0)(1,"div",1)(2,"label"),A(3,"\uD06C\uAE30:"),O(),v(4,"input",2),z("change",function(r){return o.onFontSizeChange(r)}),O()(),v(5,"div",1)(6,"label"),A(7,"\uD3F0\uD2B8:"),O(),v(8,"select",3),z("change",function(r){return o.onFontFamilyChange(r)}),v(9,"option",4),A(10,"Arial"),O(),v(11,"option",5),A(12,"Helvetica"),O(),v(13,"option",6),A(14,"Times New Roman"),O(),v(15,"option",7),A(16,"Courier New"),O(),v(17,"option",8),A(18,"Georgia"),O(),v(19,"option",9),A(20,"Verdana"),O(),v(21,"option",10),A(22,"\uB098\uB214\uACE0\uB515"),O(),v(23,"option",11),A(24,"Pretendard"),O(),v(25,"option",12),A(26,"Noto Sans KR"),O(),v(27,"option",13),A(28,"\uAE30\uBCF8 \uD55C\uAE00\uD3F0\uD2B8"),O()()(),v(29,"div",1)(30,"button",14),z("click",function(){return o.onBoldToggle()}),v(31,"strong"),A(32,"B"),O()(),v(33,"button",15),z("click",function(){return o.onItalicToggle()}),v(34,"em"),A(35,"I"),O()(),v(36,"button",16),z("click",function(){return o.onUnderlineToggle()}),v(37,"u"),A(38,"U"),O()()(),v(39,"div",1)(40,"button",17),z("click",function(){return o.onTextAlignChange("left")}),A(41," \u2261 "),O(),v(42,"button",18),z("click",function(){return o.onTextAlignChange("center")}),A(43," \u2261 "),O(),v(44,"button",19),z("click",function(){return o.onTextAlignChange("right")}),A(45," \u2261 "),O()(),v(46,"div",1)(47,"label"),A(48,"\uC0C9\uC0C1:"),O(),v(49,"input",20),z("change",function(r){return o.onColorChange(r)}),O()()()),e&2&&(Q("left",o.position.x,"px")("top",o.position.y,"px"),G("ngClass",o.cssClass),F(4),G("value",o.textEditor.fontSize),F(4),G("value",o.textEditor.fontFamily),F(22),U("active",o.textEditor.bold),F(3),U("active",o.textEditor.italic),F(3),U("active",o.textEditor.underline),F(4),U("active",o.textEditor.textAlign==="left"),F(2),U("active",o.textEditor.textAlign==="center"),F(2),U("active",o.textEditor.textAlign==="right"),F(5),G("value",o.textEditor.color))},dependencies:[dt,mt,ft],styles:['@charset "UTF-8";.text-style-toolbar[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #ddd;border-radius:4px;padding:8px;display:flex;gap:12px;align-items:center;box-shadow:0 2px 8px #00000026;z-index:1001;font-size:12px;white-space:nowrap}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;color:#666;white-space:nowrap}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:50px;padding:2px 4px;border:1px solid #ddd;border-radius:2px;font-size:12px}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:2px 4px;border:1px solid #ddd;border-radius:2px;font-size:12px;min-width:80px;background:#fff}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=color][_ngcontent-%COMP%]{width:30px;height:24px;border:1px solid #ddd;border-radius:2px;cursor:pointer;padding:0}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border:1px solid #ddd;background:#fff;border-radius:2px;cursor:pointer;font-size:12px;min-width:24px}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}.text-style-toolbar[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#007acc;color:#fff;border-color:#007acc}.text-style-toolbar.inline[_ngcontent-%COMP%]{position:relative;border-radius:4px 4px 0 0;box-shadow:0 -2px 8px #0000001a;padding:6px 8px;gap:8px;font-size:11px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]{gap:3px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:11px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:45px;font-size:11px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:11px;min-width:70px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   input[type=color][_ngcontent-%COMP%]{width:24px;height:20px}.text-style-toolbar.inline[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:3px 6px;font-size:10px;min-width:20px}.text-style-toolbar.floating[_ngcontent-%COMP%]{position:fixed;z-index:2000;box-shadow:0 4px 12px #0003}.text-style-toolbar.modifier[_ngcontent-%COMP%]{position:absolute;z-index:1500;box-shadow:0 4px 12px #0003}.text-style-toolbar.compact[_ngcontent-%COMP%]{padding:4px 6px;gap:6px;font-size:11px}.text-style-toolbar.compact[_ngcontent-%COMP%]   .toolbar-group[_ngcontent-%COMP%]{gap:2px}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][_ngcontent-%COMP%]{position:relative}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][title*=\\c67c\\cabd][_ngcontent-%COMP%]{text-align:left}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][title*=\\ac00\\c6b4\\b370][_ngcontent-%COMP%]{text-align:center}.toolbar-group[_ngcontent-%COMP%]   button[title*=\\c815\\b82c][title*=\\c624\\b978\\cabd][_ngcontent-%COMP%]{text-align:right}']})};var Pt=["textEditor"],Mt=["textarea"];function Et(T,t){if(T&1){let e=j();v(0,"div",16),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"nw"))}),O()}}function $t(T,t){if(T&1){let e=j();v(0,"div",17),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"ne"))}),O()}}function zt(T,t){if(T&1){let e=j();v(0,"div",18),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"sw"))}),O()}}function At(T,t){if(T&1){let e=j();v(0,"div",19),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"se"))}),O()}}function Ft(T,t){if(T&1){let e=j();v(0,"div",20),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"n"))}),O()}}function Rt(T,t){if(T&1){let e=j();v(0,"div",21),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"s"))}),O()}}function kt(T,t){if(T&1){let e=j();v(0,"div",22),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"w"))}),O()}}function Lt(T,t){if(T&1){let e=j();v(0,"div",23),z("mousedown",function(n){R(e);let r=V();return k(r.startResize(n,"e"))}),O()}}function Gt(T,t){if(T&1){let e=j();v(0,"app-pdf-text-adder-toolbar",24),z("fontSizeChange",function(n){R(e);let r=V();return k(r.onToolbarFontSizeChange(n))})("fontFamilyChange",function(n){R(e);let r=V();return k(r.onToolbarFontFamilyChange(n))})("boldToggle",function(n){R(e);let r=V();return k(r.onToolbarBoldToggle(n))})("italicToggle",function(n){R(e);let r=V();return k(r.onToolbarItalicToggle(n))})("underlineToggle",function(n){R(e);let r=V();return k(r.onToolbarUnderlineToggle(n))})("textAlignChange",function(n){R(e);let r=V();return k(r.onToolbarTextAlignChange(n))})("colorChange",function(n){R(e);let r=V();return k(r.onToolbarColorChange(n))}),O()}if(T&2){let e=V();G("textEditor",e.convertToTextEditor())("position",e.toolbarPosition)}}var St=class T{config={id:"",x:100,y:100,width:200,height:100,rotation:0,text:"",font:{name:"Arial",size:14}};isVisible=!1;containerWidth=800;containerHeight=600;configChange=new N;close=new N;delete=new N;deactivate=new N;textEditor;textarea;toolbarPosition={x:0,y:0};showToolbar=!1;isDragging=!1;isResizing=!1;isRotating=!1;dragStart={x:0,y:0};resizeHandle="";initialRotation=0;initialAngle=0;resizeObserver;ngOnInit(){this.config.id||(this.config.id="text-editor-"+Date.now()),this.resizeObserver=new ResizeObserver(()=>{this.constrainPosition()})}ngOnChanges(t){if(t.config&&t.config.currentValue){let e=t.config.currentValue;e.isActive!==void 0&&(console.log(`\uD14D\uC2A4\uD2B8 \uC5D0\uB514\uD130 ${e.id} \uD65C\uC131\uD654 \uC0C1\uD0DC \uBCC0\uACBD:`,e.isActive),e.isActive?this.showToolbarForEditor():this.showToolbar=!1)}}ngOnDestroy(){this.resizeObserver?.disconnect()}ngAfterViewInit(){this.textarea&&this.config.text&&setTimeout(()=>{this.autoResizeTextarea(this.textarea.nativeElement)},0)}onMouseDown(t){t.preventDefault(),t.stopPropagation();let e=t.target;e.tagName!=="TEXTAREA"&&(e.classList.contains("resize-handle")?this.startResize(t,e.dataset.handle||""):e.classList.contains("rotate-handle")?this.startRotate(t):this.startDrag(t))}startDrag(t){t.preventDefault(),t.stopPropagation(),this.isDragging=!0,this.dragStart={x:t.clientX-this.config.x,y:t.clientY-this.config.y},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}startResize(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.resizeHandle=e,this.dragStart={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}startRotate(t){t.preventDefault(),t.stopPropagation(),this.isRotating=!0,this.initialRotation=this.config.rotation;let e=this.textEditor.nativeElement.getBoundingClientRect(),o=e.left+e.width/2,n=e.top+e.height/2;this.initialAngle=Math.atan2(t.clientY-n,t.clientX-o)*180/Math.PI,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.body.style.cursor="grabbing"}onMouseMove=t=>{this.isDragging?(this.config.x=t.clientX-this.dragStart.x,this.config.y=t.clientY-this.dragStart.y,this.constrainPosition()):this.isResizing?this.handleResize(t):this.isRotating&&this.handleRotate(t),this.configChange.emit(this.config),this.showToolbar&&this.updateToolbarPosition()};onMouseUp=()=>{this.isDragging=!1,this.isResizing=!1,this.isRotating=!1,this.resizeHandle="",document.body.style.cursor="",document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)};handleResize(t){let e=t.clientX-this.dragStart.x,o=t.clientY-this.dragStart.y;switch(this.resizeHandle){case"nw":this.config.x+=e,this.config.y+=o,this.config.width-=e,this.config.height-=o;break;case"ne":this.config.y+=o,this.config.width+=e,this.config.height-=o;break;case"sw":this.config.x+=e,this.config.width-=e,this.config.height+=o;break;case"se":this.config.width+=e,this.config.height+=o;break;case"n":this.config.y+=o,this.config.height-=o;break;case"s":this.config.height+=o;break;case"w":this.config.x+=e,this.config.width-=e;break;case"e":this.config.width+=e;break}this.config.width=Math.max(50,this.config.width),this.config.height=Math.max(30,this.config.height),this.dragStart={x:t.clientX,y:t.clientY},this.constrainPosition()}handleRotate(t){let e=this.textEditor.nativeElement.getBoundingClientRect(),o=e.left+e.width/2,n=e.top+e.height/2,i=Math.atan2(t.clientY-n,t.clientX-o)*180/Math.PI-this.initialAngle;this.config.rotation=(this.initialRotation+i)%360,this.config.rotation<0&&(this.config.rotation+=360)}constrainPosition(){this.config.x=Math.max(0,Math.min(this.containerWidth-this.config.width,this.config.x)),this.config.y=Math.max(0,Math.min(this.containerHeight-this.config.height,this.config.y))}onTextChange(t){let e=t.target,o=this.config.text;if(this.config.text=e.value,console.log("=== \uD14D\uC2A4\uD2B8 \uC5D0\uB514\uD130 \uBCC0\uACBD \uAC10\uC9C0 ==="),console.log("\uC5D0\uB514\uD130 ID:",this.config.id),console.log("\uC774\uC804 \uD14D\uC2A4\uD2B8:",o),console.log("\uC0C8 \uD14D\uC2A4\uD2B8:",this.config.text),console.log("\uC6D0\uBCF8 \uD14D\uC2A4\uD2B8:",this.config.originalText),this.config.originalText!==void 0){let n=this.config.isModified;this.config.isModified=this.config.text.trim()!==this.config.originalText.trim(),console.log("\uC218\uC815 \uC0C1\uD0DC \uBCC0\uACBD:",n,"\u2192",this.config.isModified),console.log("\uD14D\uC2A4\uD2B8 \uBE44\uAD50:",{current:`"${this.config.text.trim()}"`,original:`"${this.config.originalText.trim()}"`,equal:this.config.text.trim()===this.config.originalText.trim()}),n!==this.config.isModified&&(console.log(`\u{1F504} \uC5D0\uB514\uD130 ${this.config.id} \uC218\uC815 \uC0C1\uD0DC \uBCC0\uACBD: ${n} \u2192 ${this.config.isModified}`),this.config.isModified?console.log(`\u{1F4DD} \uC5D0\uB514\uD130 ${this.config.id}\uAC00 \uC218\uC815\uB428\uC73C\uB85C \uD45C\uC2DC\uB428 (\uC800\uC7A5 \uB300\uC0C1\uC5D0 \uD3EC\uD568\uB428)`):console.log(`\u{1F504} \uC5D0\uB514\uD130 ${this.config.id}\uAC00 \uC6D0\uBCF8\uC73C\uB85C \uB418\uB3CC\uC544\uAC10`))}this.autoResizeTextarea(e),console.log("\uC0C1\uC704 \uCEF4\uD3EC\uB10C\uD2B8\uB85C \uBCC0\uACBD\uC0AC\uD56D \uC804\uB2EC \uC911..."),this.configChange.emit(this.config),console.log("=== \uD14D\uC2A4\uD2B8 \uC5D0\uB514\uD130 \uBCC0\uACBD \uCC98\uB9AC \uC644\uB8CC ===")}autoResizeTextarea(t){let e=t.style.height;t.style.height="auto";let o=this.config.font?.size||14,n=Math.max(o*1.5+16,30),r=t.scrollHeight,i=Math.max(r,n);this.config.height=i,t.style.height=i+"px",this.configChange.emit(this.config)}onTextareaMouseDown(t){t.stopPropagation()}onTextareaClick(t){t.stopPropagation();let e=t.target;if(this.config.isActive)e.focus(),this.showToolbarForEditor();else{let o=new CustomEvent("activate-text-editor",{detail:{editorId:this.config.id}});document.dispatchEvent(o)}}onClose(){this.close.emit()}onDelete(){this.delete.emit(this.config.id)}onDeactivate(){this.deactivate.emit(this.config.id)}focusTextarea(){this.textarea&&this.textarea.nativeElement.focus()}getTransform(){return`translate(${this.config.x}px, ${this.config.y}px) rotate(${this.config.rotation}deg)`}getTextareaStyle(){let t=this.config.font?.name||"Arial",e=this.config.font?.size||14,o=this.config.font?.color||"#000000",n=this.config.font?.weight||"normal",r=this.config.font?.style||"normal",i=this.config.font?.letterSpacing||0,a=this.config.font?.lineHeight||1.2;return{fontSize:`${e}px`,fontFamily:'"Pretendard Variable", "Pretendard", "Noto Sans KR", "NanumGothicLocal", "NanumGothic", "\uB098\uB214\uACE0\uB515", sans-serif',color:o,fontWeight:n,fontStyle:r,letterSpacing:`${i}px`,lineHeight:a,fontKerning:"auto",fontVariantLigatures:"common-ligatures",fontFeatureSettings:'"kern" 1',textSizeAdjust:"100%",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",fontStretch:"semi-condensed",transform:"scaleX(0.97)",wordBreak:"keep-all",overflowWrap:"break-word",backgroundColor:"rgba(255, 255, 255, 0.9)",width:"100%",height:"100%",border:"none",outline:"none",resize:"none",overflow:"hidden",padding:"2px 4px",margin:"0",boxSizing:"border-box"}}isTextModified(){return this.config.originalText?this.config.text.trim()!==this.config.originalText.trim():!1}convertToTextEditor(){return{id:this.config.id,x:this.config.x,y:this.config.y,width:this.config.width,height:this.config.height,text:this.config.text,fontSize:this.config.font?.size||14,fontFamily:this.config.font?.name||"Arial",color:this.config.font?.color||"#000000",bold:this.config.font?.weight==="bold"||this.config.font?.weight==="700",italic:this.config.font?.style==="italic",underline:!1,textAlign:"left",zIndex:1e3}}showToolbarForEditor(){this.config.isActive&&(this.showToolbar=!0,this.updateToolbarPosition())}updateToolbarPosition(){let t=this.containerWidth||800,e=this.containerHeight||600,o=400,n=50,r=this.config.x,i=this.config.y;i=this.config.y-n-10,r+o>t-20&&(r=t-o-20),i<10&&(i=this.config.y+this.config.height+10),i+n>e-20&&(i=e-n-20),r<10&&(r=10),this.toolbarPosition={x:r,y:i}}onToolbarFontSizeChange(t){this.config.font?this.config.font.size=t.fontSize:this.config.font={name:"Arial",size:t.fontSize},this.configChange.emit(this.config)}onToolbarFontFamilyChange(t){this.config.font?this.config.font.name=t.fontFamily:this.config.font={name:t.fontFamily,size:14},this.configChange.emit(this.config)}onToolbarBoldToggle(t){this.config.font?this.config.font.weight=t.bold?"bold":"normal":this.config.font={name:"Arial",size:14,weight:t.bold?"bold":"normal"},this.configChange.emit(this.config)}onToolbarItalicToggle(t){this.config.font?this.config.font.style=t.italic?"italic":"normal":this.config.font={name:"Arial",size:14,style:t.italic?"italic":"normal"},this.configChange.emit(this.config)}onToolbarUnderlineToggle(t){console.log("Underline toggle not supported in TextEditorConfig")}onToolbarTextAlignChange(t){console.log("Text align change not supported in TextEditorConfig")}onToolbarColorChange(t){this.config.font?this.config.font.color=t.color:this.config.font={name:"Arial",size:14,color:t.color},this.configChange.emit(this.config)}static \u0275fac=function(e){return new(e||T)};static \u0275cmp=J({type:T,selectors:[["app-pdf-text-modifier"]],viewQuery:function(e,o){if(e&1&&(nt(Pt,5),nt(Mt,5)),e&2){let n;it(n=rt())&&(o.textEditor=n.first),it(n=rt())&&(o.textarea=n.first)}},inputs:{config:"config",isVisible:"isVisible",containerWidth:"containerWidth",containerHeight:"containerHeight"},outputs:{configChange:"configChange",close:"close",delete:"delete",deactivate:"deactivate"},standalone:!1,features:[K],decls:17,vars:30,consts:[["textEditor",""],["textarea",""],[1,"text-editor-container"],["title","\uB4DC\uB798\uADF8\uD558\uC5EC \uC774\uB3D9",1,"drag-handle",3,"mousedown"],[1,"drag-indicator"],["placeholder","\uD14D\uC2A4\uD2B8\uB97C \uC785\uB825\uD558\uC138\uC694...",1,"text-input",3,"input","mousedown","click","ngStyle","value","readonly"],[1,"border"],["class","resize-handle nw","data-handle","nw",3,"mousedown",4,"ngIf"],["class","resize-handle ne","data-handle","ne",3,"mousedown",4,"ngIf"],["class","resize-handle sw","data-handle","sw",3,"mousedown",4,"ngIf"],["class","resize-handle se","data-handle","se",3,"mousedown",4,"ngIf"],["class","resize-handle n","data-handle","n",3,"mousedown",4,"ngIf"],["class","resize-handle s","data-handle","s",3,"mousedown",4,"ngIf"],["class","resize-handle w","data-handle","w",3,"mousedown",4,"ngIf"],["class","resize-handle e","data-handle","e",3,"mousedown",4,"ngIf"],["cssClass","modifier",3,"textEditor","position","fontSizeChange","fontFamilyChange","boldToggle","italicToggle","underlineToggle","textAlignChange","colorChange",4,"ngIf"],["data-handle","nw",1,"resize-handle","nw",3,"mousedown"],["data-handle","ne",1,"resize-handle","ne",3,"mousedown"],["data-handle","sw",1,"resize-handle","sw",3,"mousedown"],["data-handle","se",1,"resize-handle","se",3,"mousedown"],["data-handle","n",1,"resize-handle","n",3,"mousedown"],["data-handle","s",1,"resize-handle","s",3,"mousedown"],["data-handle","w",1,"resize-handle","w",3,"mousedown"],["data-handle","e",1,"resize-handle","e",3,"mousedown"],["cssClass","modifier",3,"fontSizeChange","fontFamilyChange","boldToggle","italicToggle","underlineToggle","textAlignChange","colorChange","textEditor","position"]],template:function(e,o){if(e&1){let n=j();v(0,"div",2,0)(2,"div",3),z("mousedown",function(i){return R(n),k(o.startDrag(i))}),v(3,"div",4),A(4,"\u22EE\u22EE"),O()(),v(5,"textarea",5,1),z("input",function(i){return R(n),k(o.onTextChange(i))})("mousedown",function(i){return R(n),k(o.onTextareaMouseDown(i))})("click",function(i){return R(n),k(o.onTextareaClick(i))}),O(),ct(7,"div",6),ot(8,Et,1,0,"div",7)(9,$t,1,0,"div",8)(10,zt,1,0,"div",9)(11,At,1,0,"div",10)(12,Ft,1,0,"div",11)(13,Rt,1,0,"div",12)(14,kt,1,0,"div",13)(15,Lt,1,0,"div",14),O(),ot(16,Gt,1,2,"app-pdf-text-adder-toolbar",15)}e&2&&(Q("display",o.isVisible?"block":"none")("transform",o.getTransform())("width",o.config.width,"px")("height",o.config.height,"px"),U("dragging",o.isDragging)("resizing",o.isResizing)("rotating",o.isRotating)("text-modified",o.isTextModified())("active-editor",o.config.isActive),F(5),G("ngStyle",o.getTextareaStyle())("value",o.config.text)("readonly",!o.config.isActive),F(3),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.config.isActive),F(),G("ngIf",o.showToolbar&&o.config.isActive))},dependencies:[ut,pt,Z],styles:[".text-editor-container[_ngcontent-%COMP%]{position:absolute;min-width:50px;min-height:30px;z-index:1000;-webkit-user-select:none;user-select:none;box-sizing:border-box}.text-editor-container[_ngcontent-%COMP%]:hover   .resize-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:hover   .rotate-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:hover   .control-panel[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:hover   .drag-handle[_ngcontent-%COMP%]{opacity:1}.text-editor-container.text-modified[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border-color:#ffc107;box-shadow:0 0 4px #ffc10780}.text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .resize-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .rotate-handle[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .control-panel[_ngcontent-%COMP%], .text-editor-container[_ngcontent-%COMP%]:not(.active-editor):hover   .drag-handle[_ngcontent-%COMP%]{opacity:0}.drag-handle[_ngcontent-%COMP%]{position:absolute;top:50%;left:-25px;transform:translateY(-50%);width:15px;height:30px;background:#b2b2b2;border:1px solid #fff;border-radius:4px 0 0 4px;display:flex;align-items:center;justify-content:center;cursor:move;opacity:0;transition:opacity .2s ease;z-index:2;color:#fff;font-size:10px}.drag-handle[_ngcontent-%COMP%]   .drag-indicator[_ngcontent-%COMP%]{font-weight:700;line-height:1;transform:rotate(90deg)}.drag-handle[_ngcontent-%COMP%]:hover{background:#323232}.text-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;border:none;outline:none;resize:none;background:transparent;z-index:1;cursor:text;overflow:hidden;word-wrap:break-word;white-space:pre-wrap}.text-input[readonly][_ngcontent-%COMP%]{cursor:pointer;background-color:#fffc;color:#333}.border[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;box-sizing:border-box;border:2px solid #007ACC}.resize-handle[_ngcontent-%COMP%]{position:absolute;background:#007acc;border:1px solid #fff;opacity:0;transition:opacity .2s ease;z-index:2}.resize-handle.nw[_ngcontent-%COMP%], .resize-handle.ne[_ngcontent-%COMP%], .resize-handle.sw[_ngcontent-%COMP%], .resize-handle.se[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%}.resize-handle.n[_ngcontent-%COMP%], .resize-handle.s[_ngcontent-%COMP%]{width:20px;height:6px;left:50%;transform:translate(-50%)}.resize-handle.w[_ngcontent-%COMP%], .resize-handle.e[_ngcontent-%COMP%]{width:6px;height:20px;top:50%;transform:translateY(-50%)}.resize-handle.nw[_ngcontent-%COMP%]{top:-4px;left:-4px;cursor:nw-resize}.resize-handle.ne[_ngcontent-%COMP%]{top:-4px;right:-4px;cursor:ne-resize}.resize-handle.sw[_ngcontent-%COMP%]{bottom:-4px;left:-4px;cursor:sw-resize}.resize-handle.se[_ngcontent-%COMP%]{bottom:-4px;right:-4px;cursor:se-resize}.resize-handle.n[_ngcontent-%COMP%]{top:-3px;cursor:n-resize}.resize-handle.s[_ngcontent-%COMP%]{bottom:-3px;cursor:s-resize}.resize-handle.w[_ngcontent-%COMP%]{left:-3px;cursor:w-resize}.resize-handle.e[_ngcontent-%COMP%]{right:-3px;cursor:e-resize}.rotate-handle[_ngcontent-%COMP%]{position:absolute;top:-30px;left:50%;transform:translate(-50%);width:24px;height:24px;background:#ffc107;border:1px solid #fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:grab;opacity:0;transition:opacity .2s ease;z-index:2;color:#212529}.rotate-handle[_ngcontent-%COMP%]:active{cursor:grabbing}.rotate-handle[_ngcontent-%COMP%]:hover{background:#e0a800}.rotate-handle[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}.control-panel[_ngcontent-%COMP%]{position:absolute;bottom:-35px;right:-5px;background:#fffffff2;border:1px solid #ccc;border-radius:4px;padding:4px;opacity:0;transition:opacity .2s ease;z-index:3;box-shadow:0 2px 8px #00000026}.control-panel[_ngcontent-%COMP%]   .control-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:4px}.btn-close[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%], .btn-deactivate[_ngcontent-%COMP%]{width:24px;height:24px;border:none;border-radius:2px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center}.btn-close[_ngcontent-%COMP%]:hover, .btn-delete[_ngcontent-%COMP%]:hover, .btn-deactivate[_ngcontent-%COMP%]:hover{opacity:.7}.btn-close[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-delete[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-deactivate[_ngcontent-%COMP%]{background:#ffc107;color:#212529}.text-input[_ngcontent-%COMP%]{line-height:inherit;vertical-align:top;text-align:left;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.text-editor-container.dragging[_ngcontent-%COMP%]   .text-input[_ngcontent-%COMP%], .text-editor-container.resizing[_ngcontent-%COMP%]   .text-input[_ngcontent-%COMP%], .text-editor-container.rotating[_ngcontent-%COMP%]   .text-input[_ngcontent-%COMP%]{pointer-events:none;-webkit-user-select:none;user-select:none}.text-editor-container.dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{opacity:.5;background:#414141;cursor:grabbing}.text-editor-container.rotating[_ngcontent-%COMP%]   .rotate-handle[_ngcontent-%COMP%]{opacity:1;background:#e0a800;cursor:grabbing}.text-editor-container.selected[_ngcontent-%COMP%]   .resize-handle[_ngcontent-%COMP%], .text-editor-container.selected[_ngcontent-%COMP%]   .rotate-handle[_ngcontent-%COMP%], .text-editor-container.selected[_ngcontent-%COMP%]   .control-panel[_ngcontent-%COMP%], .text-editor-container.selected[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{opacity:1}"]})};export{Ct as a,bt as b,yt as c,_t as d,Z as e,St as f};
